require 'rest_client'
module UndergroundApiHelper
  
  DEBUG = true
  STATUS_URL = "http://cloud.tfl.gov.uk/TrackerNet/LineStatus"
  WEEKEND_URL = "http://data.tfl.gov.uk/tfl/syndication/feeds/TubeThisWeekend_v2.xml"
  PREDICTION_BASE_URL = "http://cloud.tfl.gov.uk/TrackerNet/PredictionSummary/"
  STATION_PREDICTION_BASE_URL = "http://cloud.tfl.gov.uk/TrackerNet/PredictionDetailed/"
  STATION_FACILITIES_URL = "http://data.tfl.gov.uk/tfl/syndication/feeds/stations-facilities.xml"


  def self.get_line_prediction code
   stations = []
    begin
      if DEBUG
        body = "<ROOT><Time TimeStamp=\"2015/03/29 23:28:29\" /><S Code=\"ACT\" N=\"Acton Town.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"274\" T=\"0\" D=\"0\" C=\"4:00\" L=\"\" DE=\"Check Front of Train\" /><T S=\"314\" T=\"10\" D=\"219\" C=\"4:30\" L=\"Left Turnham Green\" DE=\"Heathrow T123 + 5\" /><T S=\"372\" T=\"1\" D=\"372\" C=\"6:00\" L=\"At Stamford Brook Platform 2\" DE=\"Rayners Lane\" /><T S=\"115\" T=\"1\" D=\"116\" C=\"6:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"11:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"352\" T=\"12\" D=\"219\" C=\"14:00\" L=\"Approaching Earl's Court\" DE=\"Heathrow T123 + 5\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"17:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"254\" T=\"11\" D=\"219\" C=\"17:00\" L=\"At South Kensington Platform 3\" DE=\"Heathrow T123 + 5\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"23:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"317\" T=\"10\" D=\"338\" C=\"25:00\" L=\"At Piccadilly Circus Platform 4\" DE=\"Northfields\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"30:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"371\" T=\"1\" D=\"372\" C=\"1:00\" L=\"Between Turnham Green and Acton Town\" DE=\"Rayners Lane\" /><T S=\"274\" T=\"0\" D=\"0\" C=\"2:30\" L=\"\" DE=\"Check Front of Train\" /><T S=\"314\" T=\"10\" D=\"219\" C=\"4:30\" L=\"Left Turnham Green\" DE=\"Heathrow T123 + 5\" /><T S=\"372\" T=\"1\" D=\"372\" C=\"6:00\" L=\"At Stamford Brook Platform 2\" DE=\"Rayners Lane\" /><T S=\"352\" T=\"12\" D=\"219\" C=\"14:00\" L=\"Approaching Earl's Court\" DE=\"Heathrow T123 + 5\" /><T S=\"254\" T=\"11\" D=\"219\" C=\"17:00\" L=\"At South Kensington Platform 3\" DE=\"Heathrow T123 + 5\" /><T S=\"317\" T=\"10\" D=\"338\" C=\"25:00\" L=\"At Piccadilly Circus Platform 4\" DE=\"Northfields\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"330\" T=\"9\" D=\"105\" C=\"2:00\" L=\"Between South Ealing and Acton Town\" DE=\"Cockfosters\" /><T S=\"343\" T=\"11\" D=\"105\" C=\"13:00\" L=\"Between Hounslow East and Osterley\" DE=\"Cockfosters\" /><T S=\"242\" T=\"12\" D=\"105\" C=\"26:00\" L=\"Between Heathrow Terminal 5 and Heathrow Terminal 1,2,3\" DE=\"Cockfosters\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"-\" L=\"At Platform\" DE=\"Upminster\" /><T S=\"255\" T=\"13\" D=\"104\" C=\"12:00\" L=\"At Alperton Platform 2\" DE=\"Cockfosters\" /><T S=\"343\" T=\"11\" D=\"105\" C=\"13:00\" L=\"Between Hounslow East and Osterley\" DE=\"Cockfosters\" /><T S=\"315\" T=\"11\" D=\"359\" C=\"21:00\" L=\"Between Rayners Lane and South Harrow\" DE=\"Check Front of Train\" /><T S=\"242\" T=\"12\" D=\"105\" C=\"26:00\" L=\"Between Heathrow Terminal 5 and Heathrow Terminal 1,2,3\" DE=\"Cockfosters\" /></P></S><S Code=\"ALE\" N=\"Aldgate East.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"044\" T=\"13\" D=\"123\" C=\"1:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"233\" T=\"14\" D=\"196\" C=\"6:00\" L=\"Between Bow Road and Stepney Green\" DE=\"Hammersmith\" /><T S=\"231\" T=\"14\" D=\"196\" C=\"8:00\" L=\"Between Bromley-by-Bow and Mile End\" DE=\"Hammersmith\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"10:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"21:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"032\" T=\"10\" D=\"440\" C=\"3:30\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /><T S=\"266\" T=\"4\" D=\"364\" C=\"6:00\" L=\"At Moorgate Platform 1\" DE=\"Plaistow (via King's Cross)\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"8:00\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"240\" T=\"14\" D=\"80\" C=\"16:00\" L=\"Left Great Portland Street\" DE=\"Barking\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"18:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"241\" T=\"15\" D=\"518\" C=\"23:00\" L=\"At Edgware Road Platform 1\" DE=\"Check Front of Train\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"24:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"30:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"BKG\" N=\"Barking.\"><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"054\" T=\"10\" D=\"440\" C=\"3:30\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"9:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"14:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /><T S=\"011\" T=\"14\" D=\"440\" C=\"21:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"26:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /></P><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\" /><P N=\"Westbound - Platform 6\" Code=\"0\" Next=\"0\" /></S><S Code=\"BCT\" N=\"Barons Court.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"001\" T=\"13\" D=\"116\" C=\"0:30\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"6:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"13:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"19:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"25:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"11:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"BEC\" N=\"Becontree.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /></S><S Code=\"BLF\" N=\"Blackfriars.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"064\" T=\"0\" D=\"500\" C=\"1:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"4:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"8:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"11:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"17:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"20:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"033\" T=\"10\" D=\"432\" C=\"3:30\" L=\"At Embankment Platform 2\" DE=\"Tower Hill\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"5:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"8:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"13:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"15:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"19:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"24:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"BWR\" N=\"Bow Road.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"BBB\" N=\"Bromley-by-Bow.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"045\" T=\"11\" D=\"123\" C=\"1:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"11:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"031\" T=\"10\" D=\"440\" C=\"1:30\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /><T S=\"011\" T=\"14\" D=\"440\" C=\"9:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"14:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /><T S=\"266\" T=\"4\" D=\"364\" C=\"16:00\" L=\"At Moorgate Platform 1\" DE=\"Plaistow (via King's Cross)\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"18:00\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"240\" T=\"14\" D=\"80\" C=\"26:00\" L=\"Left Great Portland Street\" DE=\"Barking\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"29:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /></P></S><S Code=\"CST\" N=\"Cannon Street.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"003\" T=\"16\" D=\"123\" C=\"1:30\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"5:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"8:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"13:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"17:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"241\" T=\"15\" D=\"518\" C=\"28:00\" L=\"At Edgware Road Platform 1\" DE=\"Check Front of Train\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"28:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"012\" T=\"12\" D=\"440\" C=\"1:30\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"033\" T=\"10\" D=\"432\" C=\"7:00\" L=\"At Embankment Platform 2\" DE=\"Tower Hill\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"8:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"11:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"17:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"18:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"23:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"27:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"CHP\" N=\"Chiswick Park.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"115\" T=\"1\" D=\"116\" C=\"4:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"9:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"15:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"21:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"28:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"2:30\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"DGE\" N=\"Dagenham East.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"440\" C=\"7:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"9:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"13:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"19:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"23:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /></P><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\" /></S><S Code=\"EBY\" N=\"Ealing Broadway.\"><P N=\"Eastbound - Platform 7\" Code=\"1\" Next=\"0\"><T S=\"062\" T=\"16\" D=\"123\" C=\"1:30\" L=\"Between Ealing Common and Ealing Broadway\" DE=\"Ealing Broadway\" /><T S=\"040\" T=\"11\" D=\"123\" C=\"4:00\" L=\"At Ealing Common Platform 1\" DE=\"Ealing Broadway\" /><T S=\"115\" T=\"1\" D=\"116\" C=\"13:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"18:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"24:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 8\" Code=\"1\" Next=\"0\"><T S=\"017\" T=\"15\" D=\"227\" C=\"-\" L=\"At Platform\" DE=\"High St Kensington\" /><T S=\"062\" T=\"16\" D=\"123\" C=\"1:30\" L=\"Between Ealing Common and Ealing Broadway\" DE=\"Ealing Broadway\" /><T S=\"040\" T=\"11\" D=\"123\" C=\"4:00\" L=\"At Ealing Common Platform 1\" DE=\"Ealing Broadway\" /><T S=\"115\" T=\"1\" D=\"116\" C=\"13:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"18:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"24:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 9\" Code=\"1\" Next=\"0\"><T S=\"062\" T=\"16\" D=\"123\" C=\"2:00\" L=\"Between Ealing Common and Ealing Broadway\" DE=\"Ealing Broadway\" /><T S=\"040\" T=\"11\" D=\"123\" C=\"4:00\" L=\"At Ealing Common Platform 1\" DE=\"Ealing Broadway\" /><T S=\"115\" T=\"1\" D=\"116\" C=\"13:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"18:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"24:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /></P></S><S Code=\"ECM\" N=\"Ealing Common.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"040\" T=\"11\" D=\"123\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"371\" T=\"1\" D=\"372\" C=\"3:30\" L=\"Between Turnham Green and Acton Town\" DE=\"Rayners Lane\" /><T S=\"274\" T=\"0\" D=\"0\" C=\"7:00\" L=\"\" DE=\"Check Front of Train\" /><T S=\"372\" T=\"1\" D=\"372\" C=\"8:00\" L=\"At Stamford Brook Platform 2\" DE=\"Rayners Lane\" /><T S=\"115\" T=\"1\" D=\"116\" C=\"9:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"14:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"20:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"27:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"255\" T=\"13\" D=\"104\" C=\"9:00\" L=\"At Alperton Platform 2\" DE=\"Cockfosters\" /><T S=\"315\" T=\"11\" D=\"359\" C=\"18:00\" L=\"Between Rayners Lane and South Harrow\" DE=\"Check Front of Train\" /></P></S><S Code=\"ECT\" N=\"Earls Court.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"15:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"014\" T=\"12\" D=\"440\" C=\"-\" L=\"At Platform\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"4:30\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"074\" T=\"27\" D=\"147\" C=\"5:00\" L=\"Left Parsons Green\" DE=\"Edgware Road\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"15:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\"><T S=\"063\" T=\"15\" D=\"500\" C=\"0:30\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"2:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"5:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"8:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"15:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"17:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"21:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"27:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /></P><P N=\"Westbound - Platform 4\" Code=\"0\" Next=\"0\"><T S=\"041\" T=\"12\" D=\"123\" C=\"2:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"4:30\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"8:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"15:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"17:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"20:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"27:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /></P></S><S Code=\"EHM\" N=\"East Ham.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"046\" T=\"11\" D=\"123\" C=\"2:30\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"010\" T=\"12\" D=\"440\" C=\"5:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"9:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /><T S=\"011\" T=\"14\" D=\"440\" C=\"17:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"22:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"27:00\" L=\"Left Mansion House\" DE=\"Upminster\" /></P></S><S Code=\"EPY\" N=\"East Putney.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\" /><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"500\" C=\"0:30\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"11:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"15:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"18:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P></S><S Code=\"ERD\" N=\"Edgware Road (H &amp; C).\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"241\" T=\"15\" D=\"518\" C=\"-\" L=\"At Platform\" DE=\"Check Front of Train\" /><T S=\"202\" T=\"26\" D=\"518\" C=\"7:00\" L=\"Between Wood Lane and Ladbroke Grove\" DE=\"Check Front of Train\" /><T S=\"215\" T=\"24\" D=\"702\" C=\"10:00\" L=\"Between South Kensington and Gloucester Road\" DE=\"Edgware Road (Circle)\" /><T S=\"257\" T=\"2\" D=\"702\" C=\"20:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /></P><P N=\"Platform 2\" Code=\"1\" Next=\"0\"><T S=\"214\" T=\"26\" D=\"702\" C=\"3:30\" L=\"Between Notting Hill Gate and Paddington\" DE=\"Edgware Road\" /></P><P N=\"Platform 3\" Code=\"1\" Next=\"0\"><T S=\"073\" T=\"26\" D=\"147\" C=\"3:00\" L=\"Between Paddington and Edgware Road\" DE=\"Edgware Road\" /><T S=\"000\" T=\"0\" D=\"147\" C=\"7:00\" L=\"Between Earl's Court and High Street Kensington\" DE=\"Edgware Road\" /><T S=\"074\" T=\"27\" D=\"147\" C=\"17:00\" L=\"Left Parsons Green\" DE=\"Edgware Road\" /></P><P N=\"Westbound - Platform 4\" Code=\"0\" Next=\"0\"><T S=\"253\" T=\"1\" D=\"196\" C=\"-\" L=\"At Platform\" DE=\"Hammersmith\" /><T S=\"206\" T=\"25\" D=\"196\" C=\"6:00\" L=\"At Great Portland Street Platform 1\" DE=\"Hammersmith\" /><T S=\"246\" T=\"14\" D=\"196\" C=\"11:00\" L=\"Between Farringdon and King's Cross\" DE=\"Hammersmith\" /><T S=\"207\" T=\"27\" D=\"196\" C=\"17:00\" L=\"At Moorgate Platform 2\" DE=\"Hammersmith\" /><T S=\"265\" T=\"5\" D=\"196\" C=\"21:00\" L=\"Between Aldgate East and Liverpool Street\" DE=\"Hammersmith\" /><T S=\"210\" T=\"22\" D=\"196\" C=\"25:00\" L=\"At Monument Platform 2\" DE=\"Hammersmith\" /><T S=\"233\" T=\"14\" D=\"196\" C=\"29:00\" L=\"Between Bow Road and Stepney Green\" DE=\"Hammersmith\" /></P></S><S Code=\"EPK\" N=\"Elm Park.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"006\" T=\"12\" D=\"440\" C=\"2:00\" L=\"Between Dagenham East and Elm Park\" DE=\"Upminster\" /><T S=\"000\" T=\"0\" D=\"440\" C=\"9:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"11:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"15:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"21:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"26:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /></P></S><S Code=\"EMB\" N=\"Embankment.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"043\" T=\"10\" D=\"123\" C=\"2:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"4:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"7:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"12:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"14:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"20:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"23:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"033\" T=\"10\" D=\"432\" C=\"-\" L=\"At Platform\" DE=\"Tower Hill\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"2:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"4:30\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"10:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"12:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"16:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"20:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"FBY\" N=\"Fulham Broadway.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"072\" T=\"26\" D=\"500\" C=\"1:30\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"6:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"8:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"21:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"035\" T=\"12\" D=\"440\" C=\"-\" L=\"At Platform\" DE=\"Upminster\" /><T S=\"074\" T=\"27\" D=\"147\" C=\"1:00\" L=\"Left Parsons Green\" DE=\"Edgware Road\" /></P></S><S Code=\"GRD\" N=\"Gloucester Road.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"042\" T=\"11\" D=\"500\" C=\"2:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"6:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"12:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"14:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"18:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"24:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"215\" T=\"24\" D=\"702\" C=\"1:00\" L=\"Between South Kensington and Gloucester Road\" DE=\"Edgware Road (Circle)\" /><T S=\"257\" T=\"2\" D=\"702\" C=\"10:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"24:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"264\" T=\"11\" D=\"196\" C=\"-\" L=\"At Platform\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"4:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"8:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"19:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"GUN\" N=\"Gunnersbury.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"HMD\" N=\"Hammersmith (District and Picc).\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"001\" T=\"13\" D=\"116\" C=\"2:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"8:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"14:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"21:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"26:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"9:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"HST\" N=\"High Street Kensington.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"511\" C=\"5:00\" L=\"Between Edgware Road and Paddington\" DE=\"Check Front of Train\" /><T S=\"210\" T=\"22\" D=\"196\" C=\"29:00\" L=\"At Monument Platform 2\" DE=\"Hammersmith\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"147\" C=\"0:30\" L=\"Between Earl's Court and High Street Kensington\" DE=\"Edgware Road\" /><T S=\"215\" T=\"24\" D=\"702\" C=\"4:00\" L=\"Between South Kensington and Gloucester Road\" DE=\"Edgware Road (Circle)\" /><T S=\"074\" T=\"27\" D=\"147\" C=\"10:00\" L=\"Left Parsons Green\" DE=\"Edgware Road\" /><T S=\"257\" T=\"2\" D=\"702\" C=\"13:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"27:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /></P><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\" /><P N=\"Westbound - Platform 4\" Code=\"0\" Next=\"0\" /></S><S Code=\"HCH\" N=\"Hornchurch.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"006\" T=\"12\" D=\"440\" C=\"3:30\" L=\"Between Dagenham East and Elm Park\" DE=\"Upminster\" /><T S=\"000\" T=\"0\" D=\"440\" C=\"10:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"13:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"17:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"23:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"27:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /></P></S><S Code=\"KEW\" N=\"Kew Gardens.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"MAN\" N=\"Mansion House.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"003\" T=\"16\" D=\"123\" C=\"2:30\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"7:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"9:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"15:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"18:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"29:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /><T S=\"241\" T=\"15\" D=\"518\" C=\"29:00\" L=\"At Edgware Road Platform 1\" DE=\"Check Front of Train\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"033\" T=\"10\" D=\"432\" C=\"6:00\" L=\"At Embankment Platform 2\" DE=\"Tower Hill\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"7:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"10:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"16:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"17:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"21:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"26:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"MLE\" N=\"Mile End.\"><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\" /></S><S Code=\"MON\" N=\"Monument.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"003\" T=\"16\" D=\"123\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"4:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"7:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"12:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"16:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"241\" T=\"15\" D=\"518\" C=\"26:00\" L=\"At Edgware Road Platform 1\" DE=\"Check Front of Train\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"27:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"210\" T=\"22\" D=\"196\" C=\"-\" L=\"At Platform\" DE=\"Hammersmith\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"2:30\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"033\" T=\"10\" D=\"432\" C=\"8:00\" L=\"At Embankment Platform 2\" DE=\"Tower Hill\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"10:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"13:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"18:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"19:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"24:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"28:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"OLY\" N=\"Olympia.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"228\" C=\"-\" L=\"At Platform\" DE=\"High St Kensington\" /></P></S><S Code=\"PADc\" N=\"Paddington Circle.\"><P N=\"Inner Rail - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Outer Rail - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"PGR\" N=\"Parsons Green.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"072\" T=\"26\" D=\"500\" C=\"5:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"10:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"12:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"25:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"PLW\" N=\"Plaistow.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"046\" T=\"11\" D=\"123\" C=\"6:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"010\" T=\"12\" D=\"440\" C=\"1:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"5:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /><T S=\"011\" T=\"14\" D=\"440\" C=\"13:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"18:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"22:00\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"240\" T=\"14\" D=\"80\" C=\"30:00\" L=\"Left Great Portland Street\" DE=\"Barking\" /></P><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\"><T S=\"235\" T=\"16\" D=\"196\" C=\"-\" L=\"At Platform\" DE=\"Hammersmith\" /><T S=\"266\" T=\"4\" D=\"364\" C=\"20:00\" L=\"At Moorgate Platform 1\" DE=\"Plaistow (via King's Cross)\" /></P></S><S Code=\"PUT\" N=\"Putney Bridge.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\"><T S=\"072\" T=\"26\" D=\"500\" C=\"7:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"12:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"14:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"27:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /></P></S><S Code=\"RCP\" N=\"Ravenscourt Park.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"001\" T=\"13\" D=\"116\" C=\"4:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"9:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"16:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"23:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"28:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"7:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"RMD\" N=\"Richmond.\"><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\" /><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\" /><P N=\"Eastbound - Platform 5\" Code=\"1\" Next=\"0\" /><P N=\"Eastbound - Platform 6\" Code=\"1\" Next=\"0\" /><P N=\"Eastbound - Platform 7\" Code=\"1\" Next=\"0\" /></S><S Code=\"SSQ\" N=\"Sloane Square.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"002\" T=\"14\" D=\"123\" C=\"2:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"257\" T=\"2\" D=\"702\" C=\"6:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"8:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"11:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"14:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"19:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"21:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"28:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"30:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"034\" T=\"12\" D=\"440\" C=\"2:30\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"4:30\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"8:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"13:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"24:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"SKN\" N=\"South Kensington.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"042\" T=\"11\" D=\"500\" C=\"0:30\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"4:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"257\" T=\"2\" D=\"702\" C=\"8:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"11:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"13:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"16:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"22:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"23:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"034\" T=\"12\" D=\"440\" C=\"-\" L=\"At Platform\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"2:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"6:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"10:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"21:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"SFS\" N=\"Southfields.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\" /><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"500\" C=\"2:30\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"12:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"17:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"19:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P></S><S Code=\"SJP\" N=\"St. James's Park.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"257\" T=\"2\" D=\"702\" C=\"2:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"5:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"7:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"11:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"15:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"17:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"24:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"27:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"013\" T=\"12\" D=\"440\" C=\"1:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"6:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"8:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"12:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"17:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"28:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"STB\" N=\"Stamford Brook.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"115\" T=\"1\" D=\"116\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"5:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"11:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"17:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"24:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"30:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"5:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"STG\" N=\"Stepney Green.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"233\" T=\"14\" D=\"196\" C=\"2:30\" L=\"Between Bow Road and Stepney Green\" DE=\"Hammersmith\" /><T S=\"231\" T=\"14\" D=\"196\" C=\"3:30\" L=\"Between Bromley-by-Bow and Mile End\" DE=\"Hammersmith\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"6:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"17:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"TEM\" N=\"Temple.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"043\" T=\"10\" D=\"123\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"2:30\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"6:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"10:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"12:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"19:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"22:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"033\" T=\"10\" D=\"432\" C=\"2:00\" L=\"At Embankment Platform 2\" DE=\"Tower Hill\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"4:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"6:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"12:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"13:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"17:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"22:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"THL\" N=\"Tower Hill.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"217\" T=\"25\" D=\"702\" C=\"2:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"5:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"10:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"14:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"241\" T=\"15\" D=\"518\" C=\"24:00\" L=\"At Edgware Road Platform 1\" DE=\"Check Front of Train\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"25:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"065\" T=\"19\" D=\"511\" C=\"-\" L=\"At Platform\" DE=\"Check Front of Train\" /><T S=\"033\" T=\"10\" D=\"432\" C=\"11:00\" L=\"At Embankment Platform 2\" DE=\"Tower Hill\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"032\" T=\"10\" D=\"440\" C=\"-\" L=\"At Platform\" DE=\"Upminster\" /><T S=\"210\" T=\"22\" D=\"196\" C=\"2:30\" L=\"At Monument Platform 2\" DE=\"Hammersmith\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"5:00\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"211\" T=\"26\" D=\"196\" C=\"12:00\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"15:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"20:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"21:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"26:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /></P></S><S Code=\"TGR\" N=\"Turnham Green.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"115\" T=\"1\" D=\"116\" C=\"2:00\" L=\"At Stamford Brook Platform 1\" DE=\"Ealing Broadway\" /><T S=\"001\" T=\"13\" D=\"116\" C=\"7:00\" L=\"At Barons Court Platform 1\" DE=\"Ealing Broadway\" /><T S=\"041\" T=\"12\" D=\"123\" C=\"12:00\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"19:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"25:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"4:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"UPM\" N=\"Upminster.\"><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"511\" C=\"-\" L=\"At Platform\" DE=\"Check Front of Train\" /><T S=\"000\" T=\"0\" D=\"510\" C=\"3:30\" L=\"At Upminster Bridge Platform 2\" DE=\"Check Front of Train\" /><T S=\"006\" T=\"12\" D=\"440\" C=\"8:00\" L=\"Between Dagenham East and Elm Park\" DE=\"Upminster\" /><T S=\"000\" T=\"0\" D=\"440\" C=\"15:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"17:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"22:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"28:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /></P><P N=\"Westbound - Platform 4\" Code=\"0\" Next=\"0\"><T S=\"005\" T=\"0\" D=\"511\" C=\"-\" L=\"At Platform\" DE=\"Check Front of Train\" /><T S=\"000\" T=\"0\" D=\"510\" C=\"3:30\" L=\"At Upminster Bridge Platform 2\" DE=\"Check Front of Train\" /><T S=\"006\" T=\"12\" D=\"440\" C=\"8:00\" L=\"Between Dagenham East and Elm Park\" DE=\"Upminster\" /><T S=\"000\" T=\"0\" D=\"440\" C=\"15:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"17:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"22:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"28:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /></P><P N=\"Westbound - Platform 5\" Code=\"0\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"510\" C=\"3:30\" L=\"At Upminster Bridge Platform 2\" DE=\"Check Front of Train\" /><T S=\"006\" T=\"12\" D=\"440\" C=\"8:00\" L=\"Between Dagenham East and Elm Park\" DE=\"Upminster\" /><T S=\"000\" T=\"0\" D=\"440\" C=\"15:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"17:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"22:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"28:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /></P></S><S Code=\"UPB\" N=\"Upminster Bridge.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"510\" C=\"-\" L=\"At Platform\" DE=\"Check Front of Train\" /><T S=\"006\" T=\"12\" D=\"440\" C=\"5:00\" L=\"Between Dagenham East and Elm Park\" DE=\"Upminster\" /><T S=\"000\" T=\"0\" D=\"440\" C=\"12:00\" L=\"Between Upney and Becontree\" DE=\"Upminster\" /><T S=\"007\" T=\"14\" D=\"440\" C=\"14:00\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"19:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"25:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"29:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /></P></S><S Code=\"UPY\" N=\"Upney.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"007\" T=\"14\" D=\"440\" C=\"1:30\" L=\"Between Barking and Upney\" DE=\"Upminster\" /><T S=\"054\" T=\"10\" D=\"440\" C=\"5:00\" L=\"Between East Ham and Barking\" DE=\"Upminster\" /><T S=\"010\" T=\"12\" D=\"440\" C=\"11:00\" L=\"Between West Ham and Plaistow\" DE=\"Upminster\" /><T S=\"031\" T=\"10\" D=\"440\" C=\"16:00\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /><T S=\"011\" T=\"14\" D=\"440\" C=\"23:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"28:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /></P></S><S Code=\"UPK\" N=\"Upton Park.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"VIC\" N=\"Victoria.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"002\" T=\"14\" D=\"123\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"257\" T=\"2\" D=\"702\" C=\"4:00\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"7:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"9:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"12:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"17:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"19:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"25:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"28:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2 \" Code=\"1\" Next=\"0\"><T S=\"034\" T=\"12\" D=\"440\" C=\"4:30\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"7:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"10:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"15:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"26:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"WBT\" N=\"West Brompton.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"072\" T=\"26\" D=\"500\" C=\"-\" L=\"At Platform\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"4:30\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"7:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"19:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"035\" T=\"12\" D=\"440\" C=\"2:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"074\" T=\"27\" D=\"147\" C=\"3:00\" L=\"Left Parsons Green\" DE=\"Edgware Road\" /></P></S><S Code=\"WHM\" N=\"West Ham.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"046\" T=\"11\" D=\"123\" C=\"10:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"031\" T=\"10\" D=\"440\" C=\"3:30\" L=\"Between Bow Road and Bromley-by-Bow\" DE=\"Upminster\" /><T S=\"011\" T=\"14\" D=\"440\" C=\"11:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"16:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /><T S=\"266\" T=\"4\" D=\"364\" C=\"18:00\" L=\"At Moorgate Platform 1\" DE=\"Plaistow (via King's Cross)\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"20:00\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"240\" T=\"14\" D=\"80\" C=\"28:00\" L=\"Left Great Portland Street\" DE=\"Barking\" /></P></S><S Code=\"WKN\" N=\"West Kensington.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"041\" T=\"12\" D=\"123\" C=\"4:30\" L=\"Between Gloucester Road and Earl's Court\" DE=\"Ealing Broadway\" /><T S=\"002\" T=\"14\" D=\"123\" C=\"11:00\" L=\"At Victoria Platform 1\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"17:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"23:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"30:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"061\" T=\"17\" D=\"440\" C=\"12:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"WMS\" N=\"Westminster.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"257\" T=\"2\" D=\"702\" C=\"0:30\" L=\"Approaching Westminster\" DE=\"Edgware Road (Circle)\" /><T S=\"043\" T=\"10\" D=\"123\" C=\"4:00\" L=\"At Temple Platform 1\" DE=\"Ealing Broadway\" /><T S=\"064\" T=\"0\" D=\"500\" C=\"6:00\" L=\"Between Mansion House and Blackfriars\" DE=\"Wimbledon\" /><T S=\"003\" T=\"16\" D=\"123\" C=\"9:00\" L=\"At Monument Platform 1\" DE=\"Ealing Broadway\" /><T S=\"217\" T=\"25\" D=\"702\" C=\"14:00\" L=\"Left Aldgate\" DE=\"Edgware Road (Circle)\" /><T S=\"044\" T=\"13\" D=\"123\" C=\"16:00\" L=\"Between Whitechapel and Aldgate East\" DE=\"Ealing Broadway\" /><T S=\"252\" T=\"2\" D=\"702\" C=\"22:00\" L=\"At Farringdon Platform 1\" DE=\"Edgware Road (Circle)\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"25:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"211\" T=\"26\" D=\"196\" C=\"0:30\" L=\"Approaching Westminster\" DE=\"Hammersmith\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"2:30\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"8:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /><T S=\"264\" T=\"11\" D=\"196\" C=\"10:00\" L=\"At Gloucester Road Platform 3\" DE=\"Hammersmith\" /><T S=\"014\" T=\"12\" D=\"440\" C=\"14:00\" L=\"At Earl's Court Platform 2\" DE=\"Upminster\" /><T S=\"035\" T=\"12\" D=\"440\" C=\"18:00\" L=\"At Fulham Broadway Platform 2\" DE=\"Upminster\" /><T S=\"061\" T=\"17\" D=\"440\" C=\"29:00\" L=\"At Acton Town Platform 4\" DE=\"Upminster\" /></P></S><S Code=\"WCL\" N=\"Whitechapel.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"011\" T=\"14\" D=\"440\" C=\"1:00\" L=\"Between Aldgate East and Whitechapel\" DE=\"Upminster\" /><T S=\"032\" T=\"10\" D=\"440\" C=\"6:00\" L=\"At Tower Hill Platform 3\" DE=\"Upminster\" /><T S=\"266\" T=\"4\" D=\"364\" C=\"8:00\" L=\"At Moorgate Platform 1\" DE=\"Plaistow (via King's Cross)\" /><T S=\"012\" T=\"12\" D=\"440\" C=\"10:00\" L=\"Left Mansion House\" DE=\"Upminster\" /><T S=\"240\" T=\"14\" D=\"80\" C=\"18:00\" L=\"Left Great Portland Street\" DE=\"Barking\" /><T S=\"013\" T=\"12\" D=\"440\" C=\"21:00\" L=\"Between Victoria and St. James's Park\" DE=\"Upminster\" /><T S=\"241\" T=\"15\" D=\"518\" C=\"25:00\" L=\"At Edgware Road Platform 1\" DE=\"Check Front of Train\" /><T S=\"034\" T=\"12\" D=\"440\" C=\"26:00\" L=\"At South Kensington Platform 2\" DE=\"Upminster\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"233\" T=\"14\" D=\"196\" C=\"4:30\" L=\"Between Bow Road and Stepney Green\" DE=\"Hammersmith\" /><T S=\"231\" T=\"14\" D=\"196\" C=\"6:00\" L=\"Between Bromley-by-Bow and Mile End\" DE=\"Hammersmith\" /><T S=\"045\" T=\"11\" D=\"123\" C=\"8:00\" L=\"Between West Ham and Bromley-by-Bow\" DE=\"Ealing Broadway\" /><T S=\"046\" T=\"11\" D=\"123\" C=\"19:00\" L=\"Between Barking and East Ham\" DE=\"Ealing Broadway\" /></P></S><S Code=\"WDN\" N=\"Wimbledon.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"000\" T=\"0\" D=\"147\" C=\"-\" L=\"At Platform\" DE=\"Edgware Road\" /><T S=\"071\" T=\"27\" D=\"500\" C=\"0:30\" L=\"Left Wimbledon Park\" DE=\"Wimbledon\" /><T S=\"020\" T=\"13\" D=\"500\" C=\"1:30\" L=\"At Wimbledon Park Platform 2\" DE=\"Wimbledon\" /><T S=\"000\" T=\"0\" D=\"500\" C=\"4:30\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"15:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"19:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"22:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"071\" T=\"27\" D=\"500\" C=\"0:30\" L=\"Left Wimbledon Park\" DE=\"Wimbledon\" /><T S=\"020\" T=\"13\" D=\"500\" C=\"1:30\" L=\"At Wimbledon Park Platform 2\" DE=\"Wimbledon\" /><T S=\"000\" T=\"0\" D=\"500\" C=\"4:30\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"15:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"19:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"22:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"071\" T=\"27\" D=\"500\" C=\"1:30\" L=\"Left Wimbledon Park\" DE=\"Wimbledon\" /><T S=\"020\" T=\"13\" D=\"500\" C=\"2:30\" L=\"At Wimbledon Park Platform 2\" DE=\"Wimbledon\" /><T S=\"000\" T=\"0\" D=\"500\" C=\"5:00\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"16:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"20:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"23:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"071\" T=\"27\" D=\"500\" C=\"1:30\" L=\"Left Wimbledon Park\" DE=\"Wimbledon\" /><T S=\"020\" T=\"13\" D=\"500\" C=\"2:30\" L=\"At Wimbledon Park Platform 2\" DE=\"Wimbledon\" /><T S=\"000\" T=\"0\" D=\"500\" C=\"5:00\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"16:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"20:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"23:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P></S><S Code=\"WMP\" N=\"Wimbledon Park.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\" /><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"020\" T=\"13\" D=\"500\" C=\"-\" L=\"At Platform\" DE=\"Wimbledon\" /><T S=\"000\" T=\"0\" D=\"500\" C=\"3:30\" L=\"Approaching East Putney\" DE=\"Wimbledon\" /><T S=\"072\" T=\"26\" D=\"500\" C=\"14:00\" L=\"At West Brompton Platform 1\" DE=\"Wimbledon\" /><T S=\"063\" T=\"15\" D=\"500\" C=\"18:00\" L=\"At Earl's Court Platform 3\" DE=\"Wimbledon\" /><T S=\"042\" T=\"11\" D=\"500\" C=\"21:00\" L=\"Between Sloane Square and South Kensington\" DE=\"Wimbledon\" /></P></S></ROOT>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get PREDICTION_BASE_URL + code
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    xml.css('S').each do |s|
      code = s.attr('Code').to_s
      name = s.attr('N').to_s.gsub('.', '')
      station = Station.find_by(underground_code: code)
      if station.nil?
        station = Station.new(underground_code: code, name: name)
      end
      station.platforms = []
      s.css('P').each do |p|
        platform_name = p.attr('N').strip
        platform = {
          name: platform_name,
          next_trains: []
        }
        p.css('T').each do |t|
          next_train = {
            destination_name: t.attr('DE').strip,
            destination: Station.find_by(name: t.attr('DE').strip),
            location: t.attr('L').strip,
            set_number: t.attr('S').strip,
            trip: t.attr('T').strip,
            eta: t.attr('C').strip
          }
          platform[:next_trains] << next_train
        end
        station.platforms << platform
      end
      stations << station
    end
    return stations
  end


  def self.get_station_prediction line_code, station_code
   platforms = []
    begin
      if DEBUG
        body = "<?xml version=\"1.0\" encoding=\"utf-8\"?><ROOT xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://trackernet.lul.co.uk\">  <Disclaimer>This system is an INFORMATION ONLY system, relying entirely on information received from the relevant Operational Railway Control System(s). It is NOT considered a safety related system in the Railway Engineering sense. However, the information reported may trigger user intervention by staff regarding possible incidents on the railway, and confirmation of the situation observed should be obtained prior to any corrective action being taken.</Disclaimer>  <WhenCreated>30 Mar 2015 0:08:47</WhenCreated>  <Line>D</Line>  <LineName>District Line</LineName>  <S Code=\"WDN\" Mess=\"\" N=\"Wimbledon.\" CurTime=\"0:08:47\"><P N=\"Eastbound - Platform 1\" Num=\"1\" TrackCode=\"TD0382\" NextTrain=\"false\"><T LCID=\"1047991\" SetNo=\"073\" TripNo=\"28\" SecondsTo=\"0\" TimeTo=\"-\" Location=\"At Platform\" Destination=\"City (via Victoria)\" DestCode=\"1025\" Order=\"0\" DepartTime=\"23:04:44\" DepartInterval=\"0\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TD0382\" LN=\"D\" /><T LCID=\"1048341\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"180\" TimeTo=\"3:30\" Location=\"Between East Putney and Southfields\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"180\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TD0363\" LN=\"D\" /><T LCID=\"1041961\" SetNo=\"065\" TripNo=\"19\" SecondsTo=\"389\" TimeTo=\"6:00\" Location=\"Between Putney Bridge and East Putney\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"389\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDGEAP\" LN=\"D\" /><T LCID=\"1044421\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"1397\" TimeTo=\"23:00\" Location=\"At High Street Kensington Platform 4\" Destination=\"Check Front of Train\" DestCode=\"511\" Order=\"0\" DepartTime=\"23:07:39\" DepartInterval=\"1397\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDEZHSK\" LN=\"D\" /></P><P N=\"Eastbound - Platform 2\" Num=\"2\" TrackCode=\"TD0380\" NextTrain=\"false\"><T LCID=\"1047851\" SetNo=\"064\" TripNo=\"0\" SecondsTo=\"0\" TimeTo=\"-\" Location=\"At Platform\" Destination=\"High St Kensington\" DestCode=\"227\" Order=\"0\" DepartTime=\"23:02:29\" DepartInterval=\"0\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TD0380\" LN=\"D\" /><T LCID=\"1048341\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"180\" TimeTo=\"3:30\" Location=\"Between East Putney and Southfields\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"180\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TD0363\" LN=\"D\" /><T LCID=\"1041961\" SetNo=\"065\" TripNo=\"19\" SecondsTo=\"389\" TimeTo=\"6:00\" Location=\"Between Putney Bridge and East Putney\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"389\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDGEAP\" LN=\"D\" /><T LCID=\"1044421\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"1397\" TimeTo=\"23:00\" Location=\"At High Street Kensington Platform 4\" Destination=\"Check Front of Train\" DestCode=\"511\" Order=\"0\" DepartTime=\"23:07:39\" DepartInterval=\"1397\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDEZHSK\" LN=\"D\" /></P><P N=\"Eastbound - Platform 3\" Num=\"3\" TrackCode=\"TD0378\" NextTrain=\"false\"><T LCID=\"1048341\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"240\" TimeTo=\"4:30\" Location=\"Between East Putney and Southfields\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"240\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TD0363\" LN=\"D\" /><T LCID=\"1041961\" SetNo=\"065\" TripNo=\"19\" SecondsTo=\"449\" TimeTo=\"7:00\" Location=\"Between Putney Bridge and East Putney\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"449\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDGEAP\" LN=\"D\" /><T LCID=\"1044421\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"1457\" TimeTo=\"24:00\" Location=\"At High Street Kensington Platform 4\" Destination=\"Check Front of Train\" DestCode=\"511\" Order=\"0\" DepartTime=\"23:07:39\" DepartInterval=\"1457\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDEZHSK\" LN=\"D\" /></P><P N=\"Eastbound - Platform 4\" Num=\"4\" TrackCode=\"TD0376\" NextTrain=\"false\"><T LCID=\"1048341\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"240\" TimeTo=\"4:30\" Location=\"Between East Putney and Southfields\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"240\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TD0363\" LN=\"D\" /><T LCID=\"1041961\" SetNo=\"065\" TripNo=\"19\" SecondsTo=\"449\" TimeTo=\"7:00\" Location=\"Between Putney Bridge and East Putney\" Destination=\"Wimbledon\" DestCode=\"500\" Order=\"0\" DepartTime=\"23:08:28\" DepartInterval=\"449\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDGEAP\" LN=\"D\" /><T LCID=\"1044421\" SetNo=\"000\" TripNo=\"0\" SecondsTo=\"1457\" TimeTo=\"24:00\" Location=\"At High Street Kensington Platform 4\" Destination=\"Check Front of Train\" DestCode=\"511\" Order=\"0\" DepartTime=\"23:07:39\" DepartInterval=\"1457\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TDEZHSK\" LN=\"D\" /></P>  </S></ROOT>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get STATION_PREDICTION_BASE_URL + line_code + "/" + station_code
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    xml.css('P').each do |p|
      name = p.attr('N').strip
      platform = {
        name: name,
        next_trains: []
      }
      platforms << platform
    end
    return platforms
  end


  def self.get_status
    lines = []
    begin
      if DEBUG
        body = "<?xml version=\"1.0\" encoding=\"utf-8\"?><ArrayOfLineStatus xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns=\"http://webservices.lul.co.uk/\"><LineStatus ID=\"0\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"1\" Name=\"Bakerloo\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"1\" StatusDetails=\"No service between Woodford and Epping and between Woodford and Hainault via Grange Hill due to planned engineering work. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"75\" Name=\"Epping\" /><StationFrom ID=\"273\" Name=\"Woodford\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"94\" Name=\"Hainault\" /><StationFrom ID=\"273\" Name=\"Woodford\" /><StationVia ID=\"89\" Name=\"Grange Hill\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"2\" Name=\"Central\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"10\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"7\" Name=\"Circle\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"2\" StatusDetails=\"No service between Turnham Green and Richmond due to planned engineering work. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"190\" Name=\"Richmond\" /><StationFrom ID=\"238\" Name=\"Turnham Green\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"9\" Name=\"District\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"8\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"8\" Name=\"Hammersmith and City\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"4\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"4\" Name=\"Jubilee\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"9\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"11\" Name=\"Metropolitan\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"5\" StatusDetails=\"Minor delays Camden Town to High Barnet while we fix a signal failure at High Barnet. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"106\" Name=\"High Barnet\" /><StationFrom ID=\"35\" Name=\"Camden Town\" /><Status ID=\"MD\" CssClass=\"GoodService\" Description=\"Minor Delays\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"5\" Name=\"Northern\" /><Status ID=\"MD\" CssClass=\"GoodService\" Description=\"Minor Delays\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"6\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"6\" Name=\"Piccadilly\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"7\" StatusDetails=\"No service between Warren Street and Brixton due to planned engineering work. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"30\" Name=\"Brixton\" /><StationFrom ID=\"250\" Name=\"Warren Street\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"3\" Name=\"Victoria\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"11\" StatusDetails=\"Train service will resume at 06:15 tomorrow.\"><BranchDisruptions /><Line ID=\"12\" Name=\"Waterloo and City\" /><Status ID=\"SC\" CssClass=\"GoodService\" Description=\"Service Closed\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"82\" StatusDetails=\"No service between New Cross Gate and Crystal Palace / West Croydon, between Richmond and Willesden Junction and between Camden Rd and Stratford. GOOD SERVICE on other London Overground routes.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"305\" Name=\"Crystal Palace\" /><StationFrom ID=\"155\" Name=\"New Cross Gate\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"366\" Name=\"West Croydon\" /><StationFrom ID=\"155\" Name=\"New Cross Gate\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"269\" Name=\"Willesden Junction\" /><StationFrom ID=\"190\" Name=\"Richmond\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"224\" Name=\"Stratford\" /><StationFrom ID=\"299\" Name=\"Camden Road\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"82\" Name=\"Overground\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"81\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"81\" Name=\"DLR\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus></ArrayOfLineStatus>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get STATUS_URL
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    xml.css('LineStatus').each do |line_status|
      number = line_status.attr('ID').to_s
      name = line_status.css('Line').attr('Name').text
      line = Tube::Line.where(number: number).first_or_create(name: name)
      line.status = line_status.css('Status').attr('Description').text
      line.status_details = line_status.attr('StatusDetails').to_s
      lines << line
    end
    return lines
  end


  def self.get_weekend
    lines = []
    begin
      if DEBUG
        body = "\n<?xml version=\"1.0\" encoding=\"utf-8\" ?><SyndicatedFeed xsi:noNamespaceSchemaLocation=\"http://www.tfl.gov.uk/tfl/syndication/feeds/xsd/SyndicatedFeedTrack.xsd\" version=\"200102231620\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><Header><Identifier>TfL | Service update - weekend - tube</Identifier><DisplayTitle>TfL | Service update - weekend - tube</DisplayTitle><Version>200102231620</Version><PublishDateTime utc=\"3/29/2015 9:57:08 PM\">Sun, 29 Mar 2015 22:57:08 +01:00</PublishDateTime><Author>webteam@tfl.gov.uk</Author> <Owner>Transport for London</Owner> <RefreshRate>1</RefreshRate> <Max_Latency>2</Max_Latency> <TimeToError>2</TimeToError> <OverrideMessage /> <ErrorMessage /><FeedInfo>Developer information regarding the current state of the feed. Not to be displayed.</FeedInfo><Attribution> <Url>http://www.tfl.gov.uk</Url> <Text><![CDATA[copyright TfL]]></Text> <Logo>http://www.tfl.gov.uk/tfl-global/images/roundel.gif</Logo> </Attribution><Language>en</Language></Header><Lines><Line><Name>Bakerloo</Name><Colour>FFF</Colour><BgColour>AE6118</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Central</Name><Colour>FFF</Colour><BgColour>E41F1F</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[CENTRAL LINE: Saturday 28 and Sunday 29 March, no service between Woodford and Epping / Hainault. Replacement buses operate. This is to allow for track and drainage improvement work at Woodford. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>Circle</Name><Colour>113B92</Colour><BgColour>F8D42D</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>District</Name><Colour>FFF</Colour><BgColour>00A575</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[DISTRICT LINE: Saturday 28 and Sunday 29 March, no service between Turnham Green and Richmond to allow for track improvement work at Gunnersbury. Replacement buses operate. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>DLR</Name><Colour>FFF</Colour><BgColour>00BBB4</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>H'smith &amp; City</Name><Colour>113B92</Colour><BgColour>E899A8</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Jubilee</Name><Colour>FFF</Colour><BgColour>8F989E</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Overground</Name><Colour>FFF</Colour><BgColour>F86C00</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[LONDON OVERGROUND: Saturday 28 and Sunday 29 March, no service between New Cross Gate and West Croydon / Crystal Palace due to Network Rail track and signalling works. LONDON OVERGROUND: Saturday 28 and Sunday 29 March, No London Overground service between Richmond and Willesden Junction - Valid rail tickets will be accepted on replacement buses. LONDON OVERGROUND: Sunday 29 March, no service between Camden Road and Stratford to help prepare the London Overground network for five car trains. Replacement buses operate ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>Metropolitan</Name><Colour>FFF</Colour><BgColour>893267</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Northern</Name><Colour>FFF</Colour><BgColour>000000</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>113B92</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Piccadilly</Name><Colour>FFF</Colour><BgColour>0450A1</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Victoria</Name><Colour>FFF</Colour><BgColour>009FE0</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[VICTORIA LINE: Sunday 29 March, no service between Warren Street and Brixton while we carry out track improvement work. Replacement buses operate between Victoria and Brixton. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>Waterloo &amp; City</Name><Colour>113B92</Colour><BgColour>70C3CE</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Special Service, Service Closed]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[WATERLOO &amp; CITY LINE: Does not operate on Sundays. Waterloo and City Line: Train service will resume at 06:15 tomorrow. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line></Lines><Stations><Station><Name>Woodside Park Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WOODSIDE PARK STATION: Northbound step-free entrance for ticket holders only.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>West Ham Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[West Ham: Reduced escalator service from Monday 23 February until late March. This is while we carry out planned maintenance work on one escalator. During this time, please use alternative escalators or take care on the 36 steps. The station will be busier than normal, please follow signs and staff direction.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Seven Sisters Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Seven Sisters Underground Station: From 21 November until June 2015 there will be no down escalator service at the High Road entrance of Seven Sisters Tube station. At busy times, you may find it quicker and easier to use the station entrance in Seven Sisters Road.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Moorgate Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[MOORGATE STATION: The two escalators between the Great Northern platforms and the Northern line platforms will be taken out of service, one at a time from Saturday 29 March until December 2015. While each escalator is out of service, the remaining escalator will run up from the Northern line to the First Capital Connect platforms. Customers going down to the Northern line will only be able to do so via the spiral staircase at the end of platform 10. During peak hours customers entering the station will only be able to access the Northern line via the stairs and the spiral stairs from the ticket hall.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Brixton Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[BRIXTON STATION: Escalator works: Due to planned escalator maintenance work until late July 2015, the station is likely to be busier than usual throughout weekday morning and evening peak hours. You may find it easier to travel outside these hours or to use nearby Stockwell Tube station during the busiest times]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Camden Town Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CAMDEN TOWN: No down escalator service between 1000-1730 on Saturday and 1000-1300 on Sundays, with exit and interchange only between 1300-1730 on Sundays. Access to platforms is via the spiral stairs only.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Camden Town Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CAMDEN TOWN: No down escalator service between 1000-1730 on Saturday and 1000-1300 on Sundays, with exit and interchange only between 1300-1730 on Sundays. Access to platforms is via the spiral stairs only.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Wembley Park Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WEMBLEY PARK STATION: Reduced step free access until early April 2015. All lifts are now available except the lift between the ticket hall and platform 6 which is only served by certain southbound fast trains from Chesham.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Elephant &amp; Castle Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Elephant &amp; Castle: We are continuing our work to improve the reliability and efficiency of the lifts serving both ticket halls at Elephant &amp; Castle. During the work there will be a lift service to/from both ticket halls, however, queues are possible at peak times, so please allow a little extra time for your journey. There is a staircase to the platforms, so please take care if you do walk down.\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>King&#39;s Cross St.Pancras Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[KING&#39;S CROSS ST PANCRAS UNDERGROUND STATION: Until July 2015, the three escalators between the Northern line and westbound Piccadilly line platforms are being replaced at the same time. Entry to and exit from the Northern line, and interchange between the Northern line and all other lines at the station are affected. Please follow the clearly signed alternative routes. Allow up to 15 minutes extra.\n\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Queensway Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Queensway Station: Ticket hall improvements will start to take place from 1 February 2015, when the ticket office in this station closes.  Work will last for up to 12 weeks as we install additional ticket machines and continue to upgrade the lifts.\n\nThe ticket office will not reopen when the work is complete.\n\nTo pay for travel, you can now:\n. Use your contactless payment card\n. Use the smarter ticket machines\nor\n. Buy tickets or top up your Oyster card online or at nearby Oyster Ticket Stops.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Euston Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[EUSTON: No down escalator to the northbound Victoria line and Northern line (Bank branch) until mid-June. Access will be via the spiral stairs only during planned escalator refurbishment.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Victoria Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[VICTORIA STATION: Work is underway on the Victoria Station Upgrade and there is a one-way system to enter and exit the Victoria line ticket hall. As the works progress other routes through the station may also be subject to change. If you are travelling to London on National Rail services you can save time and avoid queuing in the ticket hall by purchasing your Underground travel at your station of origin. Alternatively, use the Transport for London Travel Information Centre located in the National Rail concourse opposite platform seven. This work is part of the Tube Improvement plan and is scheduled to be complete in 2018.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Warren Street Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WARREN STREET STATION: From Monday 2 March, no down escalator service to Victoria line platforms, between 0830 and 0930 on Mondays to Fridays. To relieve congestion at the busiest time of the day both escalators leading to the Victoria line platforms will run in the &#39;up&#39; direction. Access to the Victoria line platforms will be via the fixed stairs, which have 99 steps.\n\nThe Northern line escalators are not affected and at all other times a &#39;down&#39; escalator service to the Victoria line will be available.\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Canary Wharf Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CANARY WHARF: Reduced escalator service from Wednesday 7 January until early April. This is while we carry out planned maintenance work on two escalators, one at a time. During this work, please use alternative escalators]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Angel Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Angel Underground Station: Reduced escalator service Monday 5 January until mid-July 2015. This is while we carry out planned refurbishment work. Please use the remaining escalators. The station may be busier at times, please allow additional time for your journey.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Holloway Road Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Holloway Road Underground Station: Reduced lift service Monday 5 January until late March 2015.This is while we carry out maintenance on both lifts, one at a time. During these works, please use the remaining lift or take care on the 62 stairs.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Covent Garden Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Covent Garden: This station is open for exit only. There is no entry from street level due to planned lift maintenance. Westbound trains at weekends are not serving the station.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Covent Garden Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Covent Garden: This station is open for exit only. There is no entry from street level due to planned lift maintenance. Westbound trains at weekends are not serving the station.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Covent Garden Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Covent Garden: This station is open for exit only. There is no entry from street level due to planned lift maintenance. Westbound trains at weekends are not serving the station.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Canning Town Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Canning Town Underground Station: Reduced escalator service from Monday 26 January until late April. This is while we carry out planned maintenance work on two escalators, one at a time. Please take care on the fixed stairs. Alternatively, use escalators, stairs or lifts further along the platforms.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Vauxhall Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Vauxhall Station: No lift service between the bus station and the London Underground station until autumn 2015. \nIf you are unable to use the stairs, please take bus 360 from stop B at Vauxhall to Pimlico station, which has ramp into the ticket hall, 8 steps and then escalator access to the platforms\nFor Stockwell take bus 2 or 88 from stop D or bus 196 from stop G at Vauxhall. \nFor Brixton - take bus 2 from stop D or bus 196 from stop G at Vauxhall.\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>London Bridge Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[LONDON BRIDGE UNDERGROUND STATION: No step-free access to or from the Jubilee line at from Tuesday 24 February until mid-August. This is while we replace one lift. For step-free access to/from the Jubilee line please use buses to/from nearby Waterloo, Bermondsey or Southwark stations. To interchange between the Northern and Jubilee lines, change at King&#39;s Cross St. Pancras and Green Park. Alternatively, speak to a member of staff for assistance.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Epping Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[EPPING STATION: From Sunday 22 until Monday 30 March inclusive, there will be 160 fewer car parking spaces available in order to store equipment for planned engineering works.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Tottenham Court Road Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[TOTTENHAM COURT ROAD STATION: Closed to Central line services from Monday 5 January until early December.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Victoria Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Victoria Underground Station: From Sunday 25 January, while we construct new lift shafts as part of our Tube improvements, queues are likely at busy times when changing between the Victoria line and District/Circle line platforms. If you are travelling at peak times, or with children or luggage, or have mobility impairment, you will find it easier to change between lines using one of the alternative routes listed on the Victoria information Page. If you travel via Green Park and Westminster, there are lifts available between platforms.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Green Park Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[GREEN PARK STATION: Reduced escalator service from Monday 23 March until late July. This is while we carry out planned refurbishment work. Please use alternative escalators. At busy times, a one-way system will be in place. To change from the Victoria line to the Jubilee line, please follow signs and staff direction via the ticket hall and \nPiccadilly line.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Waterloo Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WATERLOO UNDERGROUND STATION: Planned maintenance work on moving walkway from Monday 9 March until late April. One of the two moving walkways will be out of service for planned maintenance work and will be unavailable for use. At busy times, a one-way system will be in place. Please follow signs and staff direction.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Canada Water Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CANADA WATER STATION: No down escalator service from the ticket hall to southbound London Overground platform 3 until late June 2015. This is for planned refurbishment work. During this time, please follow signs and use the stairs or lift.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Highbury &amp; Islington Rail Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Highbury &amp; Islington: Sunday 29 March, Brazil v Chile at Emirates Stadium (KO 1500): From 1630 until crowds have dispersed Highbury &amp; Islington station will operate as exit and interchange only. There will be no access to the station from street level. Please use Archway or Angel stations instead using the signed walking routes. There are also queuing systems in place at Arsenal and Finsbury Park stations. If you are walking between the Holloway Road and Angel station you are advised to use the signed route via Liverpool Road..]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Highbury &amp; Islington Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Highbury &amp; Islington: Sunday 29 March, Brazil v Chile at Emirates Stadium (KO 1500): From 1630 until crowds have dispersed Highbury &amp; Islington station will operate as exit and interchange only. There will be no access to the station from street level. Please use Archway or Angel stations instead using the signed walking routes. There are also queuing systems in place at Arsenal and Finsbury Park stations. If you are walking between the Holloway Road and Angel station you are advised to use the signed route via Liverpool Road..]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station></Stations></SyndicatedFeed>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get WEEKEND_URL
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    xml.css('Line').each do |line|
      name = line.css('Name').text.strip.gsub('&', 'and')
      line = Tube::Line.where(name: name).first_or_create
      line.status = line.css('Status').css('Text').text.strip
      line.status_details = line.css('Status').css('Message').text.strip
      lines << line
    end
    return lines
  end


  def self.update_underground_station_facilities
    if DEBUG
      xml = Nokogiri::XML(File.open('underground_station_facilities.xml'))
    else
      STATION_FACILITIES_URL
    end
    
    begin
      if DEBUG
        xml = Nokogiri::XML(File.open('underground_station_facilities.xml'))
      else
        response = RestClient.get STATION_FACILITIES_URL
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.css('station').each do |station|
      number = station.attr('id').strip
      name = station.css('name').first.text.strip
      address = station.css('address').first.text.strip
      phone = station.css('phone').first.text.strip
      zones = station.css('zones').first.text.strip
      facilities = []
      station.css('facilities').first.children.each do |facility|
        facilities << { facility.attr('name') => facility.text.strip } unless facility.attr('name').nil?
      end
      lines = []
      station.css('servingLines').first.children.each do |line|
        lines << line.text.strip unless line.text.strip.empty?
      end
      coords = station.css('coordinates').first.text.split(",")
      lat = coords[1].to_f
      lng = coords[0].to_f
      station_attributes = {
        name: name,
        address: address,
        phone: phone,
        underground: true,
        underground_zones: zones,
        facilities: facilities.to_json,
        lat: lat,
        lng: lng
      }
      station = Station.where(number: number).first_or_create(uuid: SecureRandom.uuid)
      Station.update(station.id, station_attributes)
    end
  end


end
