require 'rest_client'
module UndergroundApiHelper

  TEST = false
  DEBUG = true
  BOARD_URL = "https://api.tfl.gov.uk/StopPoint/"
  STATUS_URL = "http://cloud.tfl.gov.uk/TrackerNet/LineStatus"
  WEEKEND_URL = "http://data.tfl.gov.uk/tfl/syndication/feeds/TubeThisWeekend_v2.xml"
  PREDICTION_BASE_URL = "http://cloud.tfl.gov.uk/TrackerNet/PredictionSummary/"
  STATION_PREDICTION_BASE_URL = "http://cloud.tfl.gov.uk/TrackerNet/PredictionDetailed/"
  TEST_DATA = {
    board: '[{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"707388623","operationType":1,"vehicleId":"207","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Southbound - Platform 8","direction":"inbound","destinationNaptanId":"940GZZLUEAC","destinationName":"Elephant & Castle Underground Station","timestamp":"2015-08-04T20:37:41.705Z","timeToStation":599,"currentLocation":"At Kilburn Park Platform 2","towards":"Elephant and Castle","expectedArrival":"2015-08-04T20:47:40.705Z","timeToLive":"2015-08-04T20:47:40.705Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1664690349","operationType":1,"vehicleId":"213","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Northbound - Platform 9","direction":"outbound","destinationNaptanId":"940GZZLUHAW","destinationName":"Harrow & Wealdstone Underground Station","timestamp":"2015-08-04T20:37:41.767Z","timeToStation":119,"currentLocation":"At Regents Park Platform 1","towards":"Harrow and Wealdstone","expectedArrival":"2015-08-04T20:39:40.767Z","timeToLive":"2015-08-04T20:39:40.767Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1511434345","operationType":1,"vehicleId":"221","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Southbound - Platform 8","direction":"inbound","destinationNaptanId":"940GZZLUEAC","destinationName":"Elephant & Castle Underground Station","timestamp":"2015-08-04T20:37:41.689Z","timeToStation":419,"currentLocation":"South of Maida Vale","towards":"Elephant and Castle","expectedArrival":"2015-08-04T20:44:40.689Z","timeToLive":"2015-08-04T20:44:40.689Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-411501179","operationType":1,"vehicleId":"225","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Southbound - Platform 8","direction":"inbound","destinationNaptanId":"940GZZLUEAC","destinationName":"Elephant & Castle Underground Station","timestamp":"2015-08-04T20:37:41.673Z","timeToStation":209,"currentLocation":"Left Paddington","towards":"Elephant and Castle","expectedArrival":"2015-08-04T20:41:10.673Z","timeToLive":"2015-08-04T20:41:10.673Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"707519695","operationType":1,"vehicleId":"227","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Southbound - Platform 8","direction":"inbound","destinationNaptanId":"940GZZLUEAC","destinationName":"Elephant & Castle Underground Station","timestamp":"2015-08-04T20:37:41.658Z","timeToStation":29,"currentLocation":"Approaching Baker Street","towards":"Elephant and Castle","expectedArrival":"2015-08-04T20:38:10.658Z","timeToLive":"2015-08-04T20:38:10.658Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-411304571","operationType":1,"vehicleId":"235","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Northbound - Platform 9","direction":"outbound","destinationNaptanId":"940GZZLUSGP","destinationName":"Stonebridge Park Underground Station","timestamp":"2015-08-04T20:37:41.783Z","timeToStation":479,"currentLocation":"At Charing Cross Platform 1","towards":"Stonebridge Park","expectedArrival":"2015-08-04T20:45:40.783Z","timeToLive":"2015-08-04T20:45:40.783Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1511565417","operationType":1,"vehicleId":"241","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Northbound - Platform 9","direction":"outbound","destinationNaptanId":"940GZZLUHAW","destinationName":"Harrow & Wealdstone Underground Station","timestamp":"2015-08-04T20:37:41.736Z","timeToStation":0,"currentLocation":"At Platform","towards":"Harrow and Wealdstone","expectedArrival":"2015-08-04T20:37:41.736Z","timeToLive":"2015-08-04T20:37:41.736Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-411370107","operationType":1,"vehicleId":"245","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"bakerloo","lineName":"Bakerloo","platformName":"Northbound - Platform 9","direction":"outbound","destinationNaptanId":"940GZZLUQPS","destinationName":"Queen\'s Park Underground Station","timestamp":"2015-08-04T20:37:41.783Z","timeToStation":299,"currentLocation":"North of Piccadilly Circus","towards":"Queen\'s Park","expectedArrival":"2015-08-04T20:42:40.783Z","timeToLive":"2015-08-04T20:42:40.783Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-940511714","operationType":1,"vehicleId":"205","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"hammersmith-city","lineName":"Hammersmith & City","platformName":"Eastbound - Platform 5","timestamp":"2015-08-04T20:37:41.845Z","timeToStation":299,"currentLocation":"Between Paddington and Edgware Road","towards":"Check Front of Train","expectedArrival":"2015-08-04T20:42:40.845Z","timeToLive":"2015-08-04T20:42:40.845Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"2056371186","operationType":1,"vehicleId":"211","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"hammersmith-city","lineName":"Hammersmith & City","platformName":"Westbound - Platform 6","direction":"inbound","destinationNaptanId":"940GZZLUHSC","destinationName":"Hammersmith (H&C Line) Underground Station","timestamp":"2015-08-04T20:37:41.845Z","timeToStation":239,"currentLocation":"Between Euston Square and Great Portland Street","towards":"Hammersmith","expectedArrival":"2015-08-04T20:41:40.845Z","timeToLive":"2015-08-04T20:41:40.845Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-939921890","operationType":1,"vehicleId":"275","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"hammersmith-city","lineName":"Hammersmith & City","platformName":"Eastbound - Platform 5","timestamp":"2015-08-04T20:37:41.845Z","timeToStation":419,"currentLocation":"At Paddington platform 16","towards":"Check Front of Train","expectedArrival":"2015-08-04T20:44:40.845Z","timeToLive":"2015-08-04T20:44:40.845Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1085942805","operationType":1,"vehicleId":"315","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"jubilee","lineName":"Jubilee","platformName":"Northbound - Platform 10","direction":"inbound","destinationNaptanId":"940GZZLUSTM","destinationName":"Stanmore Underground Station","timestamp":"2015-08-04T20:37:41.877Z","timeToStation":359,"currentLocation":"At Green Park Platform 5","towards":"Stanmore","expectedArrival":"2015-08-04T20:43:40.877Z","timeToLive":"2015-08-04T20:43:40.877Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1086008341","operationType":1,"vehicleId":"325","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"jubilee","lineName":"Jubilee","platformName":"Northbound - Platform 10","direction":"inbound","destinationNaptanId":"940GZZLUSTM","destinationName":"Stanmore Underground Station","timestamp":"2015-08-04T20:37:41.877Z","timeToStation":599,"currentLocation":"Approaching Waterloo","towards":"Stanmore","expectedArrival":"2015-08-04T20:47:40.877Z","timeToLive":"2015-08-04T20:47:40.877Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"35948039","operationType":1,"vehicleId":"341","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"jubilee","lineName":"Jubilee","platformName":"Southbound - Platform 7","direction":"outbound","destinationNaptanId":"940GZZLUSTD","destinationName":"Stratford Underground Station","timestamp":"2015-08-04T20:37:41.861Z","timeToStation":419,"currentLocation":"Between West Hampstead and Finchley Road","towards":"Stratford","expectedArrival":"2015-08-04T20:44:40.861Z","timeToLive":"2015-08-04T20:44:40.861Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"438264918","operationType":1,"vehicleId":"344","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"jubilee","lineName":"Jubilee","platformName":"Northbound - Platform 10","direction":"inbound","destinationNaptanId":"940GZZLUWYP","destinationName":"Wembley Park Underground Station","timestamp":"2015-08-04T20:37:41.861Z","timeToStation":209,"currentLocation":"At Bond Street Platform 3","towards":"Wembley Park","expectedArrival":"2015-08-04T20:41:10.861Z","timeToLive":"2015-08-04T20:41:10.861Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"1913703073","operationType":1,"vehicleId":"357","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"jubilee","lineName":"Jubilee","platformName":"Southbound - Platform 7","direction":"outbound","destinationNaptanId":"940GZZLUNGW","destinationName":"North Greenwich Underground Station","timestamp":"2015-08-04T20:37:41.861Z","timeToStation":299,"currentLocation":"Between Swiss Cottage and St. John\'s Wood","towards":"North Greenwich","expectedArrival":"2015-08-04T20:42:40.861Z","timeToLive":"2015-08-04T20:42:40.861Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"355065567","operationType":1,"vehicleId":"401","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"metropolitan","lineName":"Metropolitan","platformName":"Southbound - Platform 3","direction":"outbound","destinationNaptanId":"940GZZLUALD","destinationName":"Aldgate Underground Station","timestamp":"2015-08-04T20:37:41.877Z","timeToStation":0,"currentLocation":"At Platform","towards":"Aldgate","expectedArrival":"2015-08-04T20:37:41.877Z","timeToLive":"2015-08-04T20:37:41.877Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1336847038","operationType":1,"vehicleId":"402","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"metropolitan","lineName":"Metropolitan","platformName":"Northbound - Platform 1","direction":"inbound","destinationNaptanId":"940GZZLUWAF","destinationName":"Watford Underground Station","timestamp":"2015-08-04T20:37:41.845Z","timeToStation":0,"currentLocation":"At Platform","towards":"Watford","expectedArrival":"2015-08-04T20:37:41.845Z","timeToLive":"2015-08-04T20:37:41.845Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1336781502","operationType":1,"vehicleId":"412","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"metropolitan","lineName":"Metropolitan","platformName":"Northbound - Platform 2","direction":"inbound","destinationNaptanId":"940GZZLUUXB","destinationName":"Uxbridge Underground Station","timestamp":"2015-08-04T20:37:41.861Z","timeToStation":359,"currentLocation":"At King\'s Cross Platform 1","towards":"Uxbridge","expectedArrival":"2015-08-04T20:43:40.861Z","timeToLive":"2015-08-04T20:43:40.861Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"355196639","operationType":1,"vehicleId":"421","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"metropolitan","lineName":"Metropolitan","platformName":"Southbound - Platform 3","direction":"outbound","destinationNaptanId":"940GZZLUALD","destinationName":"Aldgate Underground Station","timestamp":"2015-08-04T20:37:41.908Z","timeToStation":119,"currentLocation":"Between Finchley Road and Baker Street","towards":"Aldgate","expectedArrival":"2015-08-04T20:39:40.908Z","timeToLive":"2015-08-04T20:39:40.908Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1337174718","operationType":1,"vehicleId":"432","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"metropolitan","lineName":"Metropolitan","platformName":"Northbound - Platform 2","direction":"inbound","destinationNaptanId":"940GZZLUUXB","destinationName":"Uxbridge Underground Station","timestamp":"2015-08-04T20:37:41.861Z","timeToStation":59,"currentLocation":"Between Great Portland Street and Baker Street","towards":"Uxbridge","expectedArrival":"2015-08-04T20:38:40.861Z","timeToLive":"2015-08-04T20:38:40.861Z","modeName":"tube"},{"$type":"Tfl.Api.Presentation.Entities.Prediction, Tfl.Api.Presentation.Entities","id":"-1472099533","operationType":1,"vehicleId":"465","naptanId":"940GZZLUBST","stationName":"Baker Street Underground Station","lineId":"metropolitan","lineName":"Metropolitan","platformName":"Northbound - Platform 2","direction":"inbound","destinationNaptanId":"940GZZLUCSM","destinationName":"Chesham Underground Station","timestamp":"2015-08-04T20:37:41.861Z","timeToStation":599,"currentLocation":"At Farringdon Platform 2","towards":"Chesham","expectedArrival":"2015-08-04T20:47:40.861Z","timeToLive":"2015-08-04T20:47:40.861Z","modeName":"tube"}]',
    service: '{"$type":"Tfl.Api.Presentation.Entities.RouteSequence, Tfl.Api.Presentation.Entities","lineId":"bakerloo","lineName":"Bakerloo","direction":"inbound","isOutboundOnly":false,"mode":"tube","lineStrings":["[[[-0.335219,51.5923],[-0.316911,51.5818],[-0.308433,51.5702],[-0.304,51.5626],[-0.296852,51.5523],[-0.275891,51.544],[-0.257882,51.5363],[-0.244282,51.5323],[-0.225014,51.5305],[-0.204571,51.5342],[-0.194229,51.535],[-0.185756,51.5298],[-0.18378,51.5233],[-0.175686,51.5166],[-0.170147,51.5203],[-0.163204,51.5223],[-0.157127,51.5229],[-0.146441,51.5233],[-0.141899,51.5152],[-0.133794,51.5101],[-0.127273,51.5074],[-0.122662,51.5071],[-0.114776,51.5033],[-0.11231,51.4988],[-0.100601,51.4945]]]"],"orderedLineRoutes":[{"$type":"Tfl.Api.Presentation.Entities.OrderedRoute, Tfl.Api.Presentation.Entities","name":"Elephant & Castle  &harr;  Harrow & Wealdstone ","naptanIds":["940GZZLUEAC","940GZZLULBN","940GZZLUWLO","940GZZLUEMB","940GZZLUCHX","940GZZLUPCC","940GZZLUOXC","940GZZLURGP","940GZZLUBST","940GZZLUMYB","940GZZLUERB","940GZZLUPAC","940GZZLUWKA","940GZZLUMVL","940GZZLUKPK","940GZZLUQPS","940GZZLUKSL","940GZZLUWJN","940GZZLUHSN","940GZZLUSGP","940GZZLUWYC","940GZZLUNWY","940GZZLUSKT","940GZZLUKEN","940GZZLUHAW"]}]}'
  }


  # Get board of trains coming in/out of the station
  # @param naptan code of underground station
  def self.get_board naptan
    board = StationBoard.new
    begin
      if TEST
        json = JSON.parse(TEST_DATA[:board])
      else
        response = RestClient.get BOARD_URL + naptan + "/arrivals"
        if DEBUG
          print "*****************\n"
          print response
          print "\n*****************\n"
        end
        json = JSON.parse(response.body)
      end
    rescue => e
      puts e.inspect
      return board
    end
    station = Station.find_by underground_naptan: naptan
    operator = Operator.find_by name: 'London Underground'
    json.each do |entry|
      service = Service.new
      service.operator = operator
      service.station = station
      service.line = Tube::Line.find_by name: entry['lineName']
      service.destination = Station.find_by underground_naptan: entry['destinationNaptanId']
      time = DateTime.parse(entry['expectedArrival'])
      service.sta = time
      service.eta = time
      service.std = time
      service.etd = time
      service.platform = entry['platformName']
      service.train_id = entry['vehicleId']
      service.id = 'TUBE:'
      service.id += entry['naptanId'] if entry['naptanId']
      service.id += ':'
      service.id += entry['destinationNaptanId'] if entry['destinationNaptanId']
      service.id += ':'
      service.id += entry['lineId'] if entry['lineId']
      service.id += ':'
      service.id += entry['direction'] if entry['direction']
      service.id += ':'
      service.id += time.to_i.to_s if time
      service.id += ':'
      service.id += entry['vehicleId']

      board.train_services << service
    end
    board.train_services.sort_by! {|obj| obj.sta  unless obj.blank?}
    return board
  end


  def self.get_service service_id
      # Service ID format: TUBE:STATION_NAPTAN:DESTINATION_NAPTAN:LINE_ID:ROUTE_ID:DEPARTURE_TIME:TRAIN_ID
      service = Service.new
      parts = service_id.split(':')
      service.id = service_id
      service.operator = Operator.find_by name: 'London Underground'
      service.station = Station.find_by underground_naptan: parts[1]
      service.destination = Station.find_by underground_naptan: parts[2]
      service.line = Tube::Line.find_by name: parts[2]
      time = Time.at(parts[5].to_i)
      service.train_id = parts[6]
      service.sta = time
      service.eta = time
      service.std = time
      service.etd = time
      begin
        if TEST
          json = JSON.parse(TEST_DATA[:service])
        else
          response = RestClient.get "https://api.tfl.gov.uk/Line/#{parts[3]}/Route/Sequence/#{parts[4]}"
          if DEBUG
            print "*****************\n"
            print response
            print "\n*****************\n"
          end
          json = JSON.parse(response.body)
        end
      rescue => e
        puts e.inspect
        return service
      end
      json['orderedLineRoutes'][0]['naptanIds'].each do |naptan|
        calling_point = CallingPoint.new
        calling_point.station = Station.find_by underground_naptan: naptan
        service.calling_points << calling_point
      end
      service.origin = service.calling_points.first.station
      return service
  end


  # Gets the next trains due at each platform at each station on a given line
  # @param code the underground line code
  # @return an array of stations each with an array of platforms each with an array of next trains
  def self.get_line_prediction code
   stations = []
    begin
      if TEST
        body = "<ROOT><Time TimeStamp=\"2015/04/01 19:12:47\" /><S Code=\"BNK\" N=\"Bank.\"><P N=\"Westbound - Platform 5\" Code=\"0\" Next=\"0\"><T S=\"123\" T=\"3\" D=\"547\" C=\"1:30\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"3:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"4:30\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"7:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"10:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"13:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"15:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"18:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"23:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"26:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 6\" Code=\"1\" Next=\"0\"><T S=\"063\" T=\"12\" D=\"530\" C=\"0:30\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"2:30\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"5:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"9:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"11:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"13:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"15:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"16:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"18:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"19:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"22:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"27:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"30:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"BDE\" N=\"Barkingside.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"047\" T=\"19\" D=\"550\" C=\"0:30\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /></P><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"042\" T=\"14\" D=\"532\" C=\"2:00\" L=\"At Newbury Park\" DE=\"Hainault via Newbury Park\" /><T S=\"146\" T=\"7\" D=\"532\" C=\"5:00\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"9:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"12:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"14:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"20:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"26:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"28:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"BNG\" N=\"Bethnal Green.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"001\" T=\"10\" D=\"550\" C=\"1:30\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"4:30\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"8:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"10:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"13:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"18:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"21:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"27:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"27:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"30:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"071\" T=\"10\" D=\"530\" C=\"-\" L=\"At Platform\" DE=\"Epping\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"1:30\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"4:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"6:00\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"8:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"12:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"15:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"17:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"19:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"21:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"22:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"24:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"26:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"28:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /></P></S><S Code=\"BDS\" N=\"Bond Street.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"043\" T=\"17\" D=\"548\" C=\"1:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"2:30\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"5:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"7:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"9:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"11:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"13:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"14:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"16:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"20:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"23:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"25:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"28:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"025\" T=\"9\" D=\"532\" C=\"0:30\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"3:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"4:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"5:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"7:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"9:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"11:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"17:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"19:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"27:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /></P></S><S Code=\"BHL\" N=\"Buckhurst Hill.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"112\" T=\"10\" D=\"562\" C=\"-\" L=\"At Platform\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"3:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"6:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"9:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"072\" T=\"10\" D=\"530\" C=\"2:00\" L=\"Between Woodford and Woodford Junction\" DE=\"Epping\" /><T S=\"140\" T=\"4\" D=\"530\" C=\"6:00\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"041\" T=\"17\" D=\"542\" C=\"9:00\" L=\"Between Leytonstone and Snaresbrook\" DE=\"Debden\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"12:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"17:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"20:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"23:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"29:00\" L=\"At Bank\" DE=\"Epping\" /></P></S><S Code=\"CYL\" N=\"Chancery Lane.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"066\" T=\"12\" D=\"548\" C=\"0:30\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"3:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"5:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"7:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"8:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"10:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"13:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"17:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"19:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"22:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"27:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"017\" T=\"10\" D=\"532\" C=\"2:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"5:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"7:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"9:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"10:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"12:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"13:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"15:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"18:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"23:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"26:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"CHG\" N=\"Chigwell.\"><P N=\"Inner Rail - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"050\" T=\"16\" D=\"531\" C=\"22:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /></P><P N=\"Outer Rail - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"DEB\" N=\"Debden.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"125\" T=\"6\" D=\"547\" C=\"4:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"006\" T=\"10\" D=\"542\" C=\"4:00\" L=\"Between Buckhurst Hill and Loughton\" DE=\"Debden\" /><T S=\"072\" T=\"10\" D=\"530\" C=\"7:00\" L=\"Between Woodford and Woodford Junction\" DE=\"Epping\" /><T S=\"140\" T=\"4\" D=\"530\" C=\"11:00\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"041\" T=\"17\" D=\"542\" C=\"14:00\" L=\"Between Leytonstone and Snaresbrook\" DE=\"Debden\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"17:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"22:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"25:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"28:00\" L=\"At Bethnal Green\" DE=\"Epping\" /></P></S><S Code=\"EBY\" N=\"Ealing Broadway.\"><P N=\"Eastbound - Platform 5\" Code=\"1\" Next=\"0\"><T S=\"121\" T=\"4\" D=\"543\" C=\"-\" L=\"At Platform\" DE=\"Newbury Park\" /><T S=\"075\" T=\"14\" D=\"548\" C=\"7:00\" L=\"Between East Acton and North Acton\" DE=\"Ealing Broadway\" /><T S=\"027\" T=\"9\" D=\"548\" C=\"11:00\" L=\"At White City\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"24:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"26:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 6\" Code=\"1\" Next=\"0\"><T S=\"104\" T=\"14\" D=\"558\" C=\"-\" L=\"At Platform\" DE=\"Woodford via Hainault\" /><T S=\"075\" T=\"14\" D=\"548\" C=\"7:00\" L=\"Between East Acton and North Acton\" DE=\"Ealing Broadway\" /><T S=\"027\" T=\"9\" D=\"548\" C=\"11:00\" L=\"At White City\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"25:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"26:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /></P></S><S Code=\"EAC\" N=\"East Acton.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"030\" T=\"11\" D=\"547\" C=\"0:30\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"027\" T=\"9\" D=\"548\" C=\"3:30\" L=\"At White City\" DE=\"Ealing Broadway\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"8:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"14:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"15:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"17:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"18:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"21:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"23:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"25:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"27:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"29:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"116\" T=\"10\" D=\"530\" C=\"0:30\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"3:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"11:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"16:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"EPP\" N=\"Epping.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"005\" T=\"8\" D=\"530\" C=\"5:00\" L=\"Between Debden and Theydon Bois\" DE=\"Epping\" /><T S=\"072\" T=\"10\" D=\"530\" C=\"14:00\" L=\"Between Woodford and Woodford Junction\" DE=\"Epping\" /><T S=\"140\" T=\"4\" D=\"530\" C=\"18:00\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"25:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"30:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"070\" T=\"11\" D=\"530\" C=\"1:00\" L=\"Between Theydon Bois and Epping\" DE=\"Epping\" /><T S=\"005\" T=\"8\" D=\"530\" C=\"4:30\" L=\"Between Debden and Theydon Bois\" DE=\"Epping\" /><T S=\"072\" T=\"10\" D=\"530\" C=\"14:00\" L=\"Between Woodford and Woodford Junction\" DE=\"Epping\" /><T S=\"140\" T=\"4\" D=\"530\" C=\"18:00\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"24:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"29:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /></P></S><S Code=\"FLP\" N=\"Fairlop.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\" /><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"011\" T=\"9\" D=\"532\" C=\"1:00\" L=\"Between Barkingside and Fairlop\" DE=\"Hainault via Newbury Park\" /><T S=\"042\" T=\"14\" D=\"532\" C=\"4:00\" L=\"At Newbury Park\" DE=\"Hainault via Newbury Park\" /><T S=\"146\" T=\"7\" D=\"532\" C=\"7:00\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"10:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"14:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"16:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"21:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"28:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"30:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"GHL\" N=\"Gants Hill.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"047\" T=\"19\" D=\"550\" C=\"5:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /></P><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"146\" T=\"7\" D=\"532\" C=\"0:30\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"4:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"7:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"10:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"15:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"21:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"23:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"28:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /></P></S><S Code=\"GRH\" N=\"Grange Hill.\"><P N=\"Inner Rail - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"050\" T=\"16\" D=\"531\" C=\"20:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /></P><P N=\"Outer Rail - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"GFD\" N=\"Greenford.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"103\" T=\"12\" D=\"547\" C=\"3:30\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"10:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"18:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"25:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"115\" T=\"10\" D=\"530\" C=\"1:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"7:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"HAI\" N=\"Hainault.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"011\" T=\"9\" D=\"532\" C=\"3:30\" L=\"Between Barkingside and Fairlop\" DE=\"Hainault via Newbury Park\" /><T S=\"042\" T=\"14\" D=\"532\" C=\"6:00\" L=\"At Newbury Park\" DE=\"Hainault via Newbury Park\" /><T S=\"146\" T=\"7\" D=\"532\" C=\"9:00\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"13:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"16:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"18:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"24:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"30:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /></P><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"011\" T=\"9\" D=\"532\" C=\"3:30\" L=\"Between Barkingside and Fairlop\" DE=\"Hainault via Newbury Park\" /><T S=\"042\" T=\"14\" D=\"532\" C=\"6:00\" L=\"At Newbury Park\" DE=\"Hainault via Newbury Park\" /><T S=\"146\" T=\"7\" D=\"532\" C=\"9:00\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"13:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"16:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"19:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"24:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"30:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /></P><P N=\"Inner Rail - Platform 3\" Code=\"0\" Next=\"0\"><T S=\"011\" T=\"9\" D=\"532\" C=\"3:00\" L=\"Between Barkingside and Fairlop\" DE=\"Hainault via Newbury Park\" /><T S=\"042\" T=\"14\" D=\"532\" C=\"6:00\" L=\"At Newbury Park\" DE=\"Hainault via Newbury Park\" /><T S=\"146\" T=\"7\" D=\"532\" C=\"9:00\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"12:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"18:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"24:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"30:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"HLN\" N=\"Hanger Lane.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"030\" T=\"11\" D=\"547\" C=\"5:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"13:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"20:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"26:00\" L=\"At Holborn\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"115\" T=\"10\" D=\"530\" C=\"5:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"11:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"HOL\" N=\"Holborn.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"105\" T=\"11\" D=\"547\" C=\"0:30\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"2:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"4:30\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"7:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"8:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"10:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"12:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"15:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"18:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"20:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"23:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"28:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"017\" T=\"10\" D=\"532\" C=\"0:30\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"4:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"6:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"8:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"9:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"10:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"12:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"14:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"16:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"22:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"24:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"HPK\" N=\"Holland Park.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"122\" T=\"5\" D=\"547\" C=\"-\" L=\"At Platform\" DE=\"West Ruislip\" /><T S=\"110\" T=\"10\" D=\"550\" C=\"3:30\" L=\"Between Lancaster Gate and Queensway\" DE=\"White City\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"6:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"7:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"9:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"10:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"13:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"15:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"17:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"20:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"21:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"23:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"24:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"28:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"120\" T=\"6\" D=\"531\" C=\"1:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"3:30\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"9:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"11:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"19:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"25:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"LAN\" N=\"Lancaster Gate.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"031\" T=\"11\" D=\"549\" C=\"1:30\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"3:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"4:30\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"6:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"8:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"10:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"13:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"15:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"16:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"18:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"20:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"23:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"27:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"28:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"141\" T=\"9\" D=\"530\" C=\"0:30\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"2:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"3:30\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"5:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"8:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"13:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"16:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"23:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"29:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"LEY\" N=\"Leyton.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"007\" T=\"11\" D=\"548\" C=\"1:30\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"6:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"10:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"16:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"16:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"18:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"21:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"25:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"102\" T=\"10\" D=\"532\" C=\"0:30\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"4:30\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"6:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"7:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"10:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"12:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"14:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"16:00\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"19:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"22:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"25:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"27:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"29:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /></P></S><S Code=\"LYS\" N=\"Leytonstone.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"124\" T=\"4\" D=\"549\" C=\"4:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"15:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"18:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /></P><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"124\" T=\"4\" D=\"549\" C=\"3:30\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"7:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"13:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"13:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"14:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"17:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"22:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"050\" T=\"16\" D=\"531\" C=\"0:30\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"1:30\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"3:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"6:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"8:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"10:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"12:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"14:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"17:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"18:00\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"21:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"24:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"28:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"30:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"LST\" N=\"Liverpool Street.\"><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"101\" T=\"14\" D=\"532\" C=\"-\" L=\"At Platform\" DE=\"Hainault via Newbury Park\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"2:30\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"4:30\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"8:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"11:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"13:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"15:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"17:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"18:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"20:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"22:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"24:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"29:00\" L=\"At East Acton\" DE=\"Epping\" /></P><P N=\"Westbound - Platform 5\" Code=\"0\" Next=\"0\"><T S=\"143\" T=\"8\" D=\"548\" C=\"1:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"2:30\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"4:30\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"8:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"11:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"13:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"16:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"21:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"24:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"29:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"30:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /></P></S><S Code=\"LTN\" N=\"Loughton.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"002\" T=\"11\" D=\"548\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"3:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"7:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Platform 2/3\" Code=\"1\" Next=\"0\"><T S=\"004\" T=\"9\" D=\"547\" C=\"-\" L=\"At Platform\" DE=\"West Ruislip\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"3:30\" L=\"Left Debden\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"006\" T=\"10\" D=\"542\" C=\"1:30\" L=\"Between Buckhurst Hill and Loughton\" DE=\"Debden\" /><T S=\"072\" T=\"10\" D=\"530\" C=\"4:30\" L=\"Between Woodford and Woodford Junction\" DE=\"Epping\" /><T S=\"140\" T=\"4\" D=\"530\" C=\"8:00\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"041\" T=\"17\" D=\"542\" C=\"11:00\" L=\"Between Leytonstone and Snaresbrook\" DE=\"Debden\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"15:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"20:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"23:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"26:00\" L=\"At Bethnal Green\" DE=\"Epping\" /></P></S><S Code=\"MAR\" N=\"Marble Arch.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"046\" T=\"17\" D=\"547\" C=\"1:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"2:30\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"4:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"6:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"8:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"11:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"13:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"14:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"16:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"18:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"21:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"25:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"26:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"30:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"016\" T=\"8\" D=\"530\" C=\"1:30\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"2:30\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"4:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"5:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"7:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"10:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"15:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"18:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"26:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /></P></S><S Code=\"MLE\" N=\"Mile End.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"061\" T=\"13\" D=\"547\" C=\"2:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"5:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"7:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"10:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"15:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"18:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"24:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"24:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"27:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"30:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"020\" T=\"8\" D=\"542\" C=\"0:30\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"3:30\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"5:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"7:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"9:00\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"12:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"15:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"18:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"20:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"22:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"24:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"25:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"27:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"29:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /></P></S><S Code=\"NEP\" N=\"Newbury Park.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"047\" T=\"19\" D=\"550\" C=\"2:30\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /></P><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"042\" T=\"14\" D=\"532\" C=\"-\" L=\"At Platform\" DE=\"Hainault via Newbury Park\" /><T S=\"146\" T=\"7\" D=\"532\" C=\"3:30\" L=\"At Gants Hill\" DE=\"Hainault via Newbury Park\" /><T S=\"145\" T=\"7\" D=\"532\" C=\"7:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"10:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"12:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"18:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"24:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"26:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"NAC\" N=\"North Acton.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"075\" T=\"14\" D=\"548\" C=\"1:00\" L=\"Between East Acton and North Acton\" DE=\"Ealing Broadway\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"2:30\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"027\" T=\"9\" D=\"548\" C=\"5:00\" L=\"At White City\" DE=\"Ealing Broadway\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"10:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"16:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"17:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"19:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"20:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"23:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"25:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"27:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"29:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /></P><P N=\"Platform 2\" Code=\"1\" Next=\"0\"><T S=\"024\" T=\"10\" D=\"529\" C=\"-\" L=\"At Platform\" DE=\"Loughton\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"17:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"28:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"051\" T=\"18\" D=\"532\" C=\"0:30\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"8:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"14:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"NHT\" N=\"Northolt.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"103\" T=\"12\" D=\"547\" C=\"6:00\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"12:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"20:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"27:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"023\" T=\"9\" D=\"530\" C=\"4:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"NHG\" N=\"Notting Hill Gate.\"><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"064\" T=\"14\" D=\"529\" C=\"0:30\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"2:30\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"4:30\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"10:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"12:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"20:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"26:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P><P N=\"Westbound - Platform 4\" Code=\"0\" Next=\"0\"><T S=\"110\" T=\"10\" D=\"550\" C=\"2:30\" L=\"Between Lancaster Gate and Queensway\" DE=\"White City\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"4:30\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"6:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"7:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"9:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"11:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"13:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"16:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"18:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"20:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"21:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"23:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"27:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /></P></S><S Code=\"OXC\" N=\"Oxford Circus.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"032\" T=\"11\" D=\"548\" C=\"1:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"3:30\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"5:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"8:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"10:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"11:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"13:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"15:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"18:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"22:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"24:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"27:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"021\" T=\"9\" D=\"529\" C=\"-\" L=\"At Platform\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"2:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"4:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"5:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"7:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"8:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"10:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"13:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"18:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"21:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"28:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /></P></S><S Code=\"PER\" N=\"Perivale.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"103\" T=\"12\" D=\"547\" C=\"1:00\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"8:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"15:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"23:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"28:00\" L=\"At Holborn\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"115\" T=\"10\" D=\"530\" C=\"3:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"8:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"QWY\" N=\"Queensway.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"110\" T=\"10\" D=\"550\" C=\"1:00\" L=\"Between Lancaster Gate and Queensway\" DE=\"White City\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"3:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"4:30\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"6:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"7:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"10:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"12:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"14:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"17:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"18:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"20:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"21:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"25:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"29:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"114\" T=\"9\" D=\"532\" C=\"-\" L=\"At Platform\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"2:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"4:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"6:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"11:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"14:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"22:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"28:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"RED\" N=\"Redbridge.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"045\" T=\"17\" D=\"547\" C=\"1:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"7:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /></P><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"145\" T=\"7\" D=\"532\" C=\"2:00\" L=\"At Wanstead\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"5:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"8:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"13:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"19:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"22:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"26:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"29:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"ROD\" N=\"Roding Valley.\"><P N=\"Inner Rail - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"107\" T=\"11\" D=\"555\" C=\"3:00\" L=\"Between Chigwell and Roding Valley\" DE=\"Woodford\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"26:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /></P><P N=\"Outer Rail - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"RUG\" N=\"Ruislip Gardens.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"142\" T=\"9\" D=\"547\" C=\"3:30\" L=\"Left Northolt\" DE=\"West Ruislip\" /><T S=\"103\" T=\"12\" D=\"547\" C=\"10:00\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"16:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"24:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"023\" T=\"9\" D=\"530\" C=\"-\" L=\"At Platform\" DE=\"Epping\" /></P></S><S Code=\"SBC\" N=\"Shepherds Bush (Central Line).\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"122\" T=\"5\" D=\"547\" C=\"2:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"110\" T=\"10\" D=\"550\" C=\"5:00\" L=\"Between Lancaster Gate and Queensway\" DE=\"White City\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"8:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"9:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"11:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"12:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"15:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"17:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"19:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"21:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"23:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"24:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"26:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"30:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"022\" T=\"11\" D=\"530\" C=\"2:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"7:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"10:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"17:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"23:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"SNB\" N=\"Snaresbrook.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"124\" T=\"4\" D=\"549\" C=\"0:30\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"10:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"11:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"14:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"19:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"041\" T=\"17\" D=\"542\" C=\"1:30\" L=\"Between Leytonstone and Snaresbrook\" DE=\"Debden\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"5:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"10:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"13:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"16:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"22:00\" L=\"At Bank\" DE=\"Epping\" /></P></S><S Code=\"SRP\" N=\"South Ruislip.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"142\" T=\"9\" D=\"547\" C=\"2:00\" L=\"Left Northolt\" DE=\"West Ruislip\" /><T S=\"103\" T=\"12\" D=\"547\" C=\"8:00\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"15:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"22:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"30:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"023\" T=\"9\" D=\"530\" C=\"1:30\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"SWF\" N=\"South Woodford.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"112\" T=\"10\" D=\"562\" C=\"8:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"9:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"12:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"17:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"140\" T=\"4\" D=\"530\" C=\"-\" L=\"At Platform\" DE=\"Epping\" /><T S=\"041\" T=\"17\" D=\"542\" C=\"3:00\" L=\"Between Leytonstone and Snaresbrook\" DE=\"Debden\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"6:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"11:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"14:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"17:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"23:00\" L=\"At Bank\" DE=\"Epping\" /></P></S><S Code=\"STP\" N=\"St. Paul's.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"106\" T=\"15\" D=\"549\" C=\"1:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"3:30\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"5:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"6:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"8:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"12:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"15:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"17:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"20:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"25:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"28:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"013\" T=\"10\" D=\"531\" C=\"0:30\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"4:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"7:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"9:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"11:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"13:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"14:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"16:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"17:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"20:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"25:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"28:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"SFD\" N=\"Stratford.\"><P N=\"Westbound - Platform 3\" Code=\"0\" Next=\"0\"><T S=\"111\" T=\"11\" D=\"548\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"2:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"5:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /><T S=\"124\" T=\"4\" D=\"549\" C=\"10:00\" L=\"Approaching Snaresbrook\" DE=\"North Acton\" /><T S=\"045\" T=\"17\" D=\"547\" C=\"13:00\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"19:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /><T S=\"112\" T=\"10\" D=\"562\" C=\"19:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"22:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"24:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"29:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 6\" Code=\"1\" Next=\"0\"><T S=\"015\" T=\"10\" D=\"530\" C=\"1:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"3:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"4:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"7:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"9:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"11:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"13:00\" L=\"At Bank\" DE=\"Epping\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"15:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"19:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /><T S=\"021\" T=\"9\" D=\"529\" C=\"22:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"24:00\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"26:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"27:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"29:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"THB\" N=\"Theydon Bois.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"125\" T=\"6\" D=\"547\" C=\"-\" L=\"At Platform\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"005\" T=\"8\" D=\"530\" C=\"1:00\" L=\"Between Debden and Theydon Bois\" DE=\"Epping\" /><T S=\"072\" T=\"10\" D=\"530\" C=\"10:00\" L=\"Between Woodford and Woodford Junction\" DE=\"Epping\" /><T S=\"140\" T=\"4\" D=\"530\" C=\"14:00\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"21:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"26:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /></P></S><S Code=\"TCR\" N=\"Tottenham Court Road.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"105\" T=\"11\" D=\"547\" C=\"2:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"3:30\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"6:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"8:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"10:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"11:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"13:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /><T S=\"061\" T=\"13\" D=\"547\" C=\"17:00\" L=\"Between Stratford and Mile End\" DE=\"West Ruislip\" /><T S=\"111\" T=\"11\" D=\"548\" C=\"20:00\" L=\"At Stratford\" DE=\"Ealing Broadway\" /><T S=\"034\" T=\"9\" D=\"547\" C=\"22:00\" L=\"Between Leyton and Stratford\" DE=\"West Ruislip\" /><T S=\"007\" T=\"11\" D=\"548\" C=\"25:00\" L=\"Between Leytonstone and Leyton\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"021\" T=\"9\" D=\"529\" C=\"2:00\" L=\"At Oxford Circus\" DE=\"Loughton\" /><T S=\"025\" T=\"9\" D=\"532\" C=\"3:30\" L=\"Between Marble Arch and Bond Street\" DE=\"Hainault via Newbury Park\" /><T S=\"016\" T=\"8\" D=\"530\" C=\"6:00\" L=\"Between Lancaster Gate and Marble Arch\" DE=\"Epping\" /><T S=\"141\" T=\"9\" D=\"530\" C=\"7:00\" L=\"Approaching Lancaster Gate\" DE=\"Epping\" /><T S=\"114\" T=\"9\" D=\"532\" C=\"8:00\" L=\"At Queensway\" DE=\"Hainault via Newbury Park\" /><T S=\"064\" T=\"14\" D=\"529\" C=\"10:00\" L=\"At Notting Hill Gate\" DE=\"Loughton\" /><T S=\"120\" T=\"6\" D=\"531\" C=\"12:00\" L=\"Left Shepherd's Bush\" DE=\"Woodford Via Hainault\" /><T S=\"022\" T=\"11\" D=\"530\" C=\"14:00\" L=\"Between White City and Shepherd's Bush\" DE=\"Epping\" /><T S=\"116\" T=\"10\" D=\"530\" C=\"20:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"22:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"WAN\" N=\"Wanstead.\"><P N=\"Outer Rail - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"045\" T=\"17\" D=\"547\" C=\"2:30\" L=\"Approaching Redbridge\" DE=\"West Ruislip\" /><T S=\"047\" T=\"19\" D=\"550\" C=\"9:00\" L=\"Between Fairlop and Barkingside\" DE=\"White City\" /></P><P N=\"Inner Rail - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"145\" T=\"7\" D=\"532\" C=\"-\" L=\"At Platform\" DE=\"Hainault via Newbury Park\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"3:30\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /><T S=\"102\" T=\"10\" D=\"532\" C=\"6:00\" L=\"Approaching Leyton\" DE=\"Hainault via Newbury Park\" /><T S=\"014\" T=\"9\" D=\"532\" C=\"11:00\" L=\"Between Mile End and Stratford\" DE=\"Hainault via Newbury Park\" /><T S=\"073\" T=\"10\" D=\"532\" C=\"17:00\" L=\"Between Liverpool Street and Bethnal Green\" DE=\"Hainault via Newbury Park\" /><T S=\"101\" T=\"14\" D=\"532\" C=\"20:00\" L=\"At Liverpool Street\" DE=\"Hainault via Newbury Park\" /><T S=\"013\" T=\"10\" D=\"531\" C=\"24:00\" L=\"At St. Paul's\" DE=\"Woodford Via Hainault\" /><T S=\"017\" T=\"10\" D=\"532\" C=\"27:00\" L=\"At Holborn\" DE=\"Hainault via Newbury Park\" /></P></S><S Code=\"WAC\" N=\"West Acton.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"075\" T=\"14\" D=\"548\" C=\"4:00\" L=\"Between East Acton and North Acton\" DE=\"Ealing Broadway\" /><T S=\"027\" T=\"9\" D=\"548\" C=\"8:00\" L=\"At White City\" DE=\"Ealing Broadway\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"22:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"23:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"27:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\" /></S><S Code=\"WRP\" N=\"West Ruislip.\"><P N=\"Eastbound - Platform 1\" Code=\"1\" Next=\"0\"><T S=\"044\" T=\"16\" D=\"530\" C=\"-\" L=\"At Platform\" DE=\"Epping\" /><T S=\"142\" T=\"9\" D=\"547\" C=\"7:00\" L=\"Left Northolt\" DE=\"West Ruislip\" /><T S=\"103\" T=\"12\" D=\"547\" C=\"13:00\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"20:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"28:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /></P><P N=\"Eastbound - Platform 2\" Code=\"1\" Next=\"0\"><T S=\"065\" T=\"11\" D=\"547\" C=\"0:30\" L=\"Between West Ruislip and Ruislip Gardens\" DE=\"West Ruislip\" /><T S=\"142\" T=\"9\" D=\"547\" C=\"7:00\" L=\"Left Northolt\" DE=\"West Ruislip\" /><T S=\"103\" T=\"12\" D=\"547\" C=\"13:00\" L=\"Between Hanger Lane and Perivale\" DE=\"West Ruislip\" /><T S=\"030\" T=\"11\" D=\"547\" C=\"20:00\" L=\"Approaching East Acton\" DE=\"West Ruislip\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"28:00\" L=\"At Holland Park\" DE=\"West Ruislip\" /></P></S><S Code=\"WCT\" N=\"White City.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\"><T S=\"027\" T=\"9\" D=\"548\" C=\"-\" L=\"At Platform\" DE=\"Ealing Broadway\" /><T S=\"122\" T=\"5\" D=\"547\" C=\"4:30\" L=\"At Holland Park\" DE=\"West Ruislip\" /><T S=\"110\" T=\"10\" D=\"550\" C=\"8:00\" L=\"Between Lancaster Gate and Queensway\" DE=\"White City\" /><T S=\"031\" T=\"11\" D=\"549\" C=\"10:00\" L=\"Between Marble Arch and Lancaster Gate\" DE=\"North Acton\" /><T S=\"046\" T=\"17\" D=\"547\" C=\"12:00\" L=\"Left Bond Street\" DE=\"West Ruislip\" /><T S=\"043\" T=\"17\" D=\"548\" C=\"13:00\" L=\"Left Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"032\" T=\"11\" D=\"548\" C=\"15:00\" L=\"Between Tottenham Court Road and Oxford Circus\" DE=\"Ealing Broadway\" /><T S=\"105\" T=\"11\" D=\"547\" C=\"17:00\" L=\"At Holborn\" DE=\"West Ruislip\" /><T S=\"066\" T=\"12\" D=\"548\" C=\"19:00\" L=\"Approaching Chancery Lane\" DE=\"Ealing Broadway\" /><T S=\"106\" T=\"15\" D=\"549\" C=\"22:00\" L=\"Between Bank and St. Paul's\" DE=\"North Acton\" /><T S=\"123\" T=\"3\" D=\"547\" C=\"24:00\" L=\"Between Liverpool Street and Bank\" DE=\"West Ruislip\" /><T S=\"143\" T=\"8\" D=\"548\" C=\"26:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ealing Broadway\" /><T S=\"033\" T=\"11\" D=\"562\" C=\"27:00\" L=\"Between Bethnal Green and Liverpool Street\" DE=\"Ruislip Gardens\" /><T S=\"001\" T=\"10\" D=\"550\" C=\"29:00\" L=\"Between Mile End and Bethnal Green\" DE=\"White City\" /></P><P N=\"Platform 2/3\" Code=\"1\" Next=\"0\"><T S=\"117\" T=\"10\" D=\"532\" C=\"-\" L=\"At Platform\" DE=\"Hainault via Newbury Park\" /></P><P N=\"Eastbound - Platform 4\" Code=\"1\" Next=\"0\"><T S=\"116\" T=\"10\" D=\"530\" C=\"4:00\" L=\"At East Acton\" DE=\"Epping\" /><T S=\"051\" T=\"18\" D=\"532\" C=\"6:00\" L=\"Between North Acton Junction and North Acton\" DE=\"Hainault via Newbury Park\" /><T S=\"115\" T=\"10\" D=\"530\" C=\"14:00\" L=\"Between Northolt and Greenford\" DE=\"Epping\" /><T S=\"023\" T=\"9\" D=\"530\" C=\"20:00\" L=\"At Ruislip Gardens\" DE=\"Epping\" /></P></S><S Code=\"WFD\" N=\"Woodford.\"><P N=\"Westbound - Platform 1\" Code=\"0\" Next=\"0\" /><P N=\"Westbound - Platform 2\" Code=\"0\" Next=\"0\"><T S=\"112\" T=\"10\" D=\"562\" C=\"5:00\" L=\"At Buckhurst Hill\" DE=\"Ruislip Gardens\" /><T S=\"107\" T=\"11\" D=\"555\" C=\"6:00\" L=\"Between Chigwell and Roding Valley\" DE=\"Woodford\" /><T S=\"002\" T=\"11\" D=\"548\" C=\"7:00\" L=\"At Loughton\" DE=\"Ealing Broadway\" /><T S=\"003\" T=\"9\" D=\"548\" C=\"10:00\" L=\"Left Debden\" DE=\"Ealing Broadway\" /><T S=\"125\" T=\"6\" D=\"547\" C=\"14:00\" L=\"At Theydon Bois\" DE=\"West Ruislip\" /><T S=\"050\" T=\"16\" D=\"531\" C=\"30:00\" L=\"Approaching Leytonstone\" DE=\"Woodford Via Hainault\" /></P><P N=\"Eastbound - Platform 3\" Code=\"1\" Next=\"0\"><T S=\"140\" T=\"4\" D=\"530\" C=\"3:30\" L=\"At South Woodford\" DE=\"Epping\" /><T S=\"041\" T=\"17\" D=\"542\" C=\"6:00\" L=\"Between Leytonstone and Snaresbrook\" DE=\"Debden\" /><T S=\"010\" T=\"10\" D=\"530\" C=\"9:00\" L=\"Between Leyton and Leytonstone\" DE=\"Epping\" /><T S=\"015\" T=\"10\" D=\"530\" C=\"14:00\" L=\"Between Mile End and Stratford\" DE=\"Epping\" /><T S=\"020\" T=\"8\" D=\"542\" C=\"17:00\" L=\"At Mile End\" DE=\"Debden\" /><T S=\"071\" T=\"10\" D=\"530\" C=\"20:00\" L=\"At Bethnal Green\" DE=\"Epping\" /><T S=\"063\" T=\"12\" D=\"530\" C=\"26:00\" L=\"At Bank\" DE=\"Epping\" /></P></S></ROOT>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get PREDICTION_BASE_URL + code
        if DEBUG
          print "*****************\n"
          print response
          print "\n*****************\n"
        end
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return stations
    end
    xml.remove_namespaces!
    # For each station on this line
    xml.css('S').each do |s|
      code = s.attr('Code').to_s
      station = Station.find_by(underground_code: code)
      if station.nil?
        # clean up the name to comply with naming standards
        name = s.attr('N').to_s
        name = name.gsub('.', '')
        name = name.gsub(' and ', ' & ')
        Rails.logger.error "Underground station not found: #{name} (#{code})"
        station = Station.new(underground_code: code, name: name)
      end
      station.platforms = []
      # For each platform add the next trains
      s.css('P').each do |p|
        platform_name = p.attr('N').strip
        platform = {
          name: platform_name,
          next_trains: []
        }
        p.css('T').each do |t|
          # Destination names may contain via information
          destination_name = t.attr('DE').strip
          if destination_name.include? ' via '
            destination = Station.find_by(name:destination_name.slice(0..(destination_name.index(' via '))))
          else
            destination = Station.find_by(name: destination_name)
          end
          next_train = {
            destination_name: destination_name,
            destination: destination,
            destination_code: t.attr('D').strip,
            location: t.attr('L').strip,
            set: t.attr('S').strip,
            trip: t.attr('T').strip,
            eta: t.attr('C').strip
          }
          platform[:next_trains] << next_train
        end
        station.platforms << platform
      end
      stations << station
    end
    return stations
  end


  # Get services at a station on a particular underground line
  # @param line_code the code of the underground line
  # @param station_code the code of the underground station
  # @return an array of service items
  def self.get_services_for_line_at_station line_code, station_code
   services = []
    begin
      if TEST
        body = "<?xml version=\"1.0\" encoding=\"utf-8\"?><ROOT xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://trackernet.lul.co.uk\"><Disclaimer>This system is an INFORMATION ONLY system, relying entirely on information received from the relevant Operational Railway Control System(s). It is NOT considered a safety related system in the Railway Engineering sense. However, the information reported may trigger user intervention by staff regarding possible incidents on the railway, and confirmation of the situation observed should be obtained prior to any corrective action being taken.</Disclaimer><WhenCreated>1 Apr 2015 19:13:07</WhenCreated><Line>C</Line><LineName>Central Line</LineName><S Code=\"BNK\" Mess=\"\" N=\"Bank.\" CurTime=\"19:13:07\"><P N=\"Westbound - Platform 5\" Num=\"5\" TrackCode=\"TC4710\" NextTrain=\"false\"><T LCID=\"3449621\" SetNo=\"123\" TripNo=\"3\" SecondsTo=\"58\" TimeTo=\"1:00\" Location=\"Between Liverpool Street and Bank\" Destination=\"West Ruislip\" DestCode=\"547\" Order=\"0\" DepartTime=\"18:13:05\" DepartInterval=\"58\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5026\" LN=\"C\" /><T LCID=\"3445311\" SetNo=\"143\" TripNo=\"8\" SecondsTo=\"149\" TimeTo=\"2:30\" Location=\"Approaching Liverpool Street\" Destination=\"Ealing Broadway\" DestCode=\"548\" Order=\"0\" DepartTime=\"18:13:05\" DepartInterval=\"149\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5014_2\" LN=\"C\" /><T LCID=\"3413651\" SetNo=\"033\" TripNo=\"11\" SecondsTo=\"249\" TimeTo=\"4:30\" Location=\"Between Bethnal Green and Liverpool Street\" Destination=\"Ruislip Gardens\" DestCode=\"562\" Order=\"0\" DepartTime=\"18:13:06\" DepartInterval=\"249\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5222\" LN=\"C\" /><T LCID=\"3343001\" SetNo=\"001\" TripNo=\"10\" SecondsTo=\"375\" TimeTo=\"6:00\" Location=\"Between Mile End and Bethnal Green\" Destination=\"White City\" DestCode=\"550\" Order=\"0\" DepartTime=\"18:13:06\" DepartInterval=\"375\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5200\" LN=\"C\" /><T LCID=\"3377471\" SetNo=\"061\" TripNo=\"13\" SecondsTo=\"499\" TimeTo=\"8:00\" Location=\"At Mile End\" Destination=\"West Ruislip\" DestCode=\"547\" Order=\"0\" DepartTime=\"18:13:04\" DepartInterval=\"499\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5428\" LN=\"C\" /><T LCID=\"3416161\" SetNo=\"111\" TripNo=\"11\" SecondsTo=\"756\" TimeTo=\"13:00\" Location=\"Left Stratford\" Destination=\"Ealing Broadway\" DestCode=\"548\" Order=\"0\" DepartTime=\"18:13:06\" DepartInterval=\"756\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5522\" LN=\"C\" /><T LCID=\"3418221\" SetNo=\"034\" TripNo=\"9\" SecondsTo=\"879\" TimeTo=\"15:00\" Location=\"Between Leyton and Stratford\" Destination=\"West Ruislip\" DestCode=\"547\" Order=\"0\" DepartTime=\"18:13:00\" DepartInterval=\"879\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5500\" LN=\"C\" /><T LCID=\"3414151\" SetNo=\"007\" TripNo=\"11\" SecondsTo=\"1066\" TimeTo=\"18:00\" Location=\"Between Leytonstone and Leyton\" Destination=\"Ealing Broadway\" DestCode=\"548\" Order=\"0\" DepartTime=\"18:13:03\" DepartInterval=\"1066\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC5600\" LN=\"C\" /><T LCID=\"3450871\" SetNo=\"124\" TripNo=\"4\" SecondsTo=\"1436\" TimeTo=\"24:00\" Location=\"At Snaresbrook\" Destination=\"North Acton\" DestCode=\"549\" Order=\"0\" DepartTime=\"18:13:00\" DepartInterval=\"1436\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC7008\" LN=\"C\" /><T LCID=\"3420421\" SetNo=\"045\" TripNo=\"17\" SecondsTo=\"1457\" TimeTo=\"24:00\" Location=\"At Redbridge\" Destination=\"West Ruislip\" DestCode=\"547\" Order=\"0\" DepartTime=\"18:13:03\" DepartInterval=\"1457\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC6108\" LN=\"C\" /><T LCID=\"3423981\" SetNo=\"112\" TripNo=\"10\" SecondsTo=\"1782\" TimeTo=\"30:00\" Location=\"Left Buckhurst Hill\" Destination=\"Ruislip Gardens\" DestCode=\"562\" Order=\"0\" DepartTime=\"18:12:56\" DepartInterval=\"1782\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC7508\" LN=\"C\" /></P><P N=\"Eastbound - Platform 6\" Num=\"6\" TrackCode=\"TC4711\" NextTrain=\"false\"><T LCID=\"3435571\" SetNo=\"013\" TripNo=\"10\" SecondsTo=\"119\" TimeTo=\"2:00\" Location=\"At St. Paul's\" Destination=\"Woodford Via Hainault\" DestCode=\"531\" Order=\"0\" DepartTime=\"18:13:00\" DepartInterval=\"119\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC4611\" LN=\"C\" /><T LCID=\"3416831\" SetNo=\"017\" TripNo=\"10\" SecondsTo=\"322\" TimeTo=\"5:00\" Location=\"At Holborn\" Destination=\"Hainault via Newbury Park\" DestCode=\"532\" Order=\"0\" DepartTime=\"18:12:57\" DepartInterval=\"322\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC4315\" LN=\"C\" /><T LCID=\"3420291\" SetNo=\"021\" TripNo=\"9\" SecondsTo=\"513\" TimeTo=\"9:00\" Location=\"Left Oxford Circus\" Destination=\"Loughton\" DestCode=\"529\" Order=\"0\" DepartTime=\"18:13:06\" DepartInterval=\"513\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC4009\" LN=\"C\" /><T LCID=\"3418961\" SetNo=\"025\" TripNo=\"9\" SecondsTo=\"644\" TimeTo=\"11:00\" Location=\"At Bond Street\" Destination=\"Hainault via Newbury Park\" DestCode=\"532\" Order=\"0\" DepartTime=\"18:13:03\" DepartInterval=\"644\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC3803\" LN=\"C\" /><T LCID=\"3424561\" SetNo=\"016\" TripNo=\"8\" SecondsTo=\"780\" TimeTo=\"13:00\" Location=\"Between Lancaster Gate and Marble Arch\" Destination=\"Epping\" DestCode=\"530\" Order=\"0\" DepartTime=\"18:13:05\" DepartInterval=\"780\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC3603\" LN=\"C\" /><T LCID=\"3443651\" SetNo=\"141\" TripNo=\"9\" SecondsTo=\"866\" TimeTo=\"14:00\" Location=\"At Lancaster Gate\" Destination=\"Epping\" DestCode=\"530\" Order=\"0\" DepartTime=\"18:12:59\" DepartInterval=\"866\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC3507\" LN=\"C\" /><T LCID=\"3421511\" SetNo=\"114\" TripNo=\"9\" SecondsTo=\"943\" TimeTo=\"16:00\" Location=\"At Queensway\" Destination=\"Hainault via Newbury Park\" DestCode=\"532\" Order=\"0\" DepartTime=\"18:12:46\" DepartInterval=\"943\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC3207\" LN=\"C\" /><T LCID=\"3416051\" SetNo=\"064\" TripNo=\"14\" SecondsTo=\"1045\" TimeTo=\"17:00\" Location=\"At Notting Hill Gate\" Destination=\"Loughton\" DestCode=\"529\" Order=\"0\" DepartTime=\"18:12:59\" DepartInterval=\"1045\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC3007\" LN=\"C\" /><T LCID=\"3431581\" SetNo=\"120\" TripNo=\"6\" SecondsTo=\"1147\" TimeTo=\"19:00\" Location=\"Between Shepherd's Bush and Holland Park\" Destination=\"Woodford Via Hainault\" DestCode=\"531\" Order=\"0\" DepartTime=\"18:13:02\" DepartInterval=\"1147\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC2825\" LN=\"C\" /><T LCID=\"3403221\" SetNo=\"022\" TripNo=\"11\" SecondsTo=\"1290\" TimeTo=\"21:00\" Location=\"Between White City and Shepherd's Bush\" Destination=\"Epping\" DestCode=\"530\" Order=\"0\" DepartTime=\"18:13:06\" DepartInterval=\"1290\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC2803\" LN=\"C\" /><T LCID=\"3420931\" SetNo=\"117\" TripNo=\"10\" SecondsTo=\"1428\" TimeTo=\"24:00\" Location=\"At White City\" Destination=\"Hainault via Newbury Park\" DestCode=\"532\" Order=\"0\" DepartTime=\"18:06:56\" DepartInterval=\"1428\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC2739\" LN=\"C\" /><T LCID=\"3419801\" SetNo=\"116\" TripNo=\"10\" SecondsTo=\"1674\" TimeTo=\"28:00\" Location=\"At East Acton\" Destination=\"Epping\" DestCode=\"530\" Order=\"0\" DepartTime=\"18:12:58\" DepartInterval=\"1674\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC2511\" LN=\"C\" /><T LCID=\"3413461\" SetNo=\"051\" TripNo=\"18\" SecondsTo=\"1761\" TimeTo=\"29:00\" Location=\"At North Acton\" Destination=\"Hainault via Newbury Park\" DestCode=\"532\" Order=\"0\" DepartTime=\"18:13:06\" DepartInterval=\"1761\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC2323\" LN=\"C\" /><T LCID=\"3419151\" SetNo=\"024\" TripNo=\"10\" SecondsTo=\"1778\" TimeTo=\"30:00\" Location=\"At North Acton\" Destination=\"Loughton\" DestCode=\"529\" Order=\"0\" DepartTime=\"18:07:07\" DepartInterval=\"1778\" Departed=\"0\" Direction=\"0\" IsStalled=\"0\" TrackCode=\"TC2345\" LN=\"C\" /></P></S></ROOT>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get STATION_PREDICTION_BASE_URL + line_code + "/" + station_code
        if DEBUG
          print "*****************\n"
          print response.body
          print "\n*****************\n"
        end
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return service_items
    end
    xml.remove_namespaces!
    # Get the time at the station to use to create the scheduled time of departure
    station = xml.css('S').first
    if station
      current_time = Time.parse(station.attr('CurTime').strip)
    else
      current_time = Time.now
    end
    operator = Operator.where(name: "London Underground").first
    # For each platform at this station on this line
    xml.css('P').each do |p|
      platform = p.attr('N').strip.gsub('Platform ', '')
      # Create a Service for each train
      xml.css('T').each do |t|
        service = Service.new
        service.id = "TUBE-" + line_code + "-" + station_code + "-" + t.attr('LCID').strip
        service.operator = operator
        service.platform = platform
        service.origin = nil
        service.destination = Station.where(name: t.attr('Destination').strip).first
        if service.destination && service.destination.underground_code == station_code
          next
        else
          service.std = current_time + t.attr('SecondsTo').to_i + 30
          service.etd = service.std
        end
        service.sta = current_time + t.attr('SecondsTo').to_i
        service.eta = service.sta
        services << service
      end

    end
    return services
  end


  # Get the current underground lines status
  # Add the lines to the database at the same time
  # @return an array of underground lines
  def self.get_status
    lines = []
    begin
      if TEST
        body = "<?xml version=\"1.0\" encoding=\"utf-8\"?><ArrayOfLineStatus xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns=\"http://webservices.lul.co.uk/\"><LineStatus ID=\"0\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"1\" Name=\"Bakerloo\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"1\" StatusDetails=\"No service between Woodford and Epping and between Woodford and Hainault via Grange Hill due to planned engineering work. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"75\" Name=\"Epping\" /><StationFrom ID=\"273\" Name=\"Woodford\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"94\" Name=\"Hainault\" /><StationFrom ID=\"273\" Name=\"Woodford\" /><StationVia ID=\"89\" Name=\"Grange Hill\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"2\" Name=\"Central\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"10\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"7\" Name=\"Circle\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"2\" StatusDetails=\"No service between Turnham Green and Richmond due to planned engineering work. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"190\" Name=\"Richmond\" /><StationFrom ID=\"238\" Name=\"Turnham Green\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"9\" Name=\"District\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"8\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"8\" Name=\"Hammersmith and City\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"4\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"4\" Name=\"Jubilee\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"9\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"11\" Name=\"Metropolitan\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"5\" StatusDetails=\"Minor delays Camden Town to High Barnet while we fix a signal failure at High Barnet. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"106\" Name=\"High Barnet\" /><StationFrom ID=\"35\" Name=\"Camden Town\" /><Status ID=\"MD\" CssClass=\"GoodService\" Description=\"Minor Delays\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"5\" Name=\"Northern\" /><Status ID=\"MD\" CssClass=\"GoodService\" Description=\"Minor Delays\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"6\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"6\" Name=\"Piccadilly\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"7\" StatusDetails=\"No service between Warren Street and Brixton due to planned engineering work. GOOD SERVICE on the rest of the line.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"30\" Name=\"Brixton\" /><StationFrom ID=\"250\" Name=\"Warren Street\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"3\" Name=\"Victoria\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"11\" StatusDetails=\"Train service will resume at 06:15 tomorrow.\"><BranchDisruptions /><Line ID=\"12\" Name=\"Waterloo and City\" /><Status ID=\"SC\" CssClass=\"GoodService\" Description=\"Service Closed\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"82\" StatusDetails=\"No service between New Cross Gate and Crystal Palace / West Croydon, between Richmond and Willesden Junction and between Camden Rd and Stratford. GOOD SERVICE on other London Overground routes.\"><BranchDisruptions><BranchDisruption><StationTo ID=\"305\" Name=\"Crystal Palace\" /><StationFrom ID=\"155\" Name=\"New Cross Gate\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"366\" Name=\"West Croydon\" /><StationFrom ID=\"155\" Name=\"New Cross Gate\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"269\" Name=\"Willesden Junction\" /><StationFrom ID=\"190\" Name=\"Richmond\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption><BranchDisruption><StationTo ID=\"224\" Name=\"Stratford\" /><StationFrom ID=\"299\" Name=\"Camden Road\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></BranchDisruption></BranchDisruptions><Line ID=\"82\" Name=\"Overground\" /><Status ID=\"PC\" CssClass=\"DisruptedService\" Description=\"Part Closure\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus><LineStatus ID=\"81\" StatusDetails=\"\"><BranchDisruptions /><Line ID=\"81\" Name=\"DLR\" /><Status ID=\"GS\" CssClass=\"GoodService\" Description=\"Good Service\" IsActive=\"true\"><StatusType ID=\"1\" Description=\"Line\" /></Status></LineStatus></ArrayOfLineStatus>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get STATUS_URL
        if DEBUG
          print "*****************\n"
          print response
          print "\n*****************\n"
        end
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    xml.css('LineStatus').each do |line_status|
      number = line_status.attr('ID').to_s
      name = line_status.css('Line').attr('Name').text
      line = Tube::Line.find_by number: number
      line.status = line_status.css('Status').attr('Description').text
      line.status_details = line_status.attr('StatusDetails').to_s
      lines << line
    end
    return lines
  end


  # Get the weekend underground lines status
  # @return an array of underground lines
  def self.get_weekend
    lines = []
    begin
      if TEST
        body = "\n<?xml version=\"1.0\" encoding=\"utf-8\" ?><SyndicatedFeed xsi:noNamespaceSchemaLocation=\"http://www.tfl.gov.uk/tfl/syndication/feeds/xsd/SyndicatedFeedTrack.xsd\" version=\"200102231620\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><Header><Identifier>TfL | Service update - weekend - tube</Identifier><DisplayTitle>TfL | Service update - weekend - tube</DisplayTitle><Version>200102231620</Version><PublishDateTime utc=\"3/29/2015 9:57:08 PM\">Sun, 29 Mar 2015 22:57:08 +01:00</PublishDateTime><Author>webteam@tfl.gov.uk</Author> <Owner>Transport for London</Owner> <RefreshRate>1</RefreshRate> <Max_Latency>2</Max_Latency> <TimeToError>2</TimeToError> <OverrideMessage /> <ErrorMessage /><FeedInfo>Developer information regarding the current state of the feed. Not to be displayed.</FeedInfo><Attribution> <Url>http://www.tfl.gov.uk</Url> <Text><![CDATA[copyright TfL]]></Text> <Logo>http://www.tfl.gov.uk/tfl-global/images/roundel.gif</Logo> </Attribution><Language>en</Language></Header><Lines><Line><Name>Bakerloo</Name><Colour>FFF</Colour><BgColour>AE6118</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Central</Name><Colour>FFF</Colour><BgColour>E41F1F</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[CENTRAL LINE: Saturday 28 and Sunday 29 March, no service between Woodford and Epping / Hainault. Replacement buses operate. This is to allow for track and drainage improvement work at Woodford. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>Circle</Name><Colour>113B92</Colour><BgColour>F8D42D</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>District</Name><Colour>FFF</Colour><BgColour>00A575</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[DISTRICT LINE: Saturday 28 and Sunday 29 March, no service between Turnham Green and Richmond to allow for track improvement work at Gunnersbury. Replacement buses operate. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>DLR</Name><Colour>FFF</Colour><BgColour>00BBB4</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>H'smith &amp; City</Name><Colour>113B92</Colour><BgColour>E899A8</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Jubilee</Name><Colour>FFF</Colour><BgColour>8F989E</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Overground</Name><Colour>FFF</Colour><BgColour>F86C00</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[LONDON OVERGROUND: Saturday 28 and Sunday 29 March, no service between New Cross Gate and West Croydon / Crystal Palace due to Network Rail track and signalling works. LONDON OVERGROUND: Saturday 28 and Sunday 29 March, No London Overground service between Richmond and Willesden Junction - Valid rail tickets will be accepted on replacement buses. LONDON OVERGROUND: Sunday 29 March, no service between Camden Road and Stratford to help prepare the London Overground network for five car trains. Replacement buses operate ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>Metropolitan</Name><Colour>FFF</Colour><BgColour>893267</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Northern</Name><Colour>FFF</Colour><BgColour>000000</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>113B92</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Piccadilly</Name><Colour>FFF</Colour><BgColour>0450A1</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Good Service]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour></Status></Line><Line><Name>Victoria</Name><Colour>FFF</Colour><BgColour>009FE0</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[VICTORIA LINE: Sunday 29 March, no service between Warren Street and Brixton while we carry out track improvement work. Replacement buses operate between Victoria and Brixton. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line><Line><Name>Waterloo &amp; City</Name><Colour>113B92</Colour><BgColour>70C3CE</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Special Service, Service Closed]]></Text><Colour>000000</Colour> <BgColour>FFF</BgColour><Message><Text><![CDATA[WATERLOO &amp; CITY LINE: Does not operate on Sundays. Waterloo and City Line: Train service will resume at 06:15 tomorrow. ]]></Text><Colour>FFF</Colour> <BgColour>000</BgColour></Message></Status></Line></Lines><Stations><Station><Name>Woodside Park Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WOODSIDE PARK STATION: Northbound step-free entrance for ticket holders only.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>West Ham Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[West Ham: Reduced escalator service from Monday 23 February until late March. This is while we carry out planned maintenance work on one escalator. During this time, please use alternative escalators or take care on the 36 steps. The station will be busier than normal, please follow signs and staff direction.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Seven Sisters Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Seven Sisters Underground Station: From 21 November until June 2015 there will be no down escalator service at the High Road entrance of Seven Sisters Tube station. At busy times, you may find it quicker and easier to use the station entrance in Seven Sisters Road.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Moorgate Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[MOORGATE STATION: The two escalators between the Great Northern platforms and the Northern line platforms will be taken out of service, one at a time from Saturday 29 March until December 2015. While each escalator is out of service, the remaining escalator will run up from the Northern line to the First Capital Connect platforms. Customers going down to the Northern line will only be able to do so via the spiral staircase at the end of platform 10. During peak hours customers entering the station will only be able to access the Northern line via the stairs and the spiral stairs from the ticket hall.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Brixton Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[BRIXTON STATION: Escalator works: Due to planned escalator maintenance work until late July 2015, the station is likely to be busier than usual throughout weekday morning and evening peak hours. You may find it easier to travel outside these hours or to use nearby Stockwell Tube station during the busiest times]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Camden Town Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CAMDEN TOWN: No down escalator service between 1000-1730 on Saturday and 1000-1300 on Sundays, with exit and interchange only between 1300-1730 on Sundays. Access to platforms is via the spiral stairs only.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Camden Town Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CAMDEN TOWN: No down escalator service between 1000-1730 on Saturday and 1000-1300 on Sundays, with exit and interchange only between 1300-1730 on Sundays. Access to platforms is via the spiral stairs only.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Wembley Park Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WEMBLEY PARK STATION: Reduced step free access until early April 2015. All lifts are now available except the lift between the ticket hall and platform 6 which is only served by certain southbound fast trains from Chesham.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Elephant &amp; Castle Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Elephant &amp; Castle: We are continuing our work to improve the reliability and efficiency of the lifts serving both ticket halls at Elephant &amp; Castle. During the work there will be a lift service to/from both ticket halls, however, queues are possible at peak times, so please allow a little extra time for your journey. There is a staircase to the platforms, so please take care if you do walk down.\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>King&#39;s Cross St.Pancras Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[KING&#39;S CROSS ST PANCRAS UNDERGROUND STATION: Until July 2015, the three escalators between the Northern line and westbound Piccadilly line platforms are being replaced at the same time. Entry to and exit from the Northern line, and interchange between the Northern line and all other lines at the station are affected. Please follow the clearly signed alternative routes. Allow up to 15 minutes extra.\n\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Queensway Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Queensway Station: Ticket hall improvements will start to take place from 1 February 2015, when the ticket office in this station closes.  Work will last for up to 12 weeks as we install additional ticket machines and continue to upgrade the lifts.\n\nThe ticket office will not reopen when the work is complete.\n\nTo pay for travel, you can now:\n. Use your contactless payment card\n. Use the smarter ticket machines\nor\n. Buy tickets or top up your Oyster card online or at nearby Oyster Ticket Stops.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Euston Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[EUSTON: No down escalator to the northbound Victoria line and Northern line (Bank branch) until mid-June. Access will be via the spiral stairs only during planned escalator refurbishment.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Victoria Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[VICTORIA STATION: Work is underway on the Victoria Station Upgrade and there is a one-way system to enter and exit the Victoria line ticket hall. As the works progress other routes through the station may also be subject to change. If you are travelling to London on National Rail services you can save time and avoid queuing in the ticket hall by purchasing your Underground travel at your station of origin. Alternatively, use the Transport for London Travel Information Centre located in the National Rail concourse opposite platform seven. This work is part of the Tube Improvement plan and is scheduled to be complete in 2018.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Warren Street Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WARREN STREET STATION: From Monday 2 March, no down escalator service to Victoria line platforms, between 0830 and 0930 on Mondays to Fridays. To relieve congestion at the busiest time of the day both escalators leading to the Victoria line platforms will run in the &#39;up&#39; direction. Access to the Victoria line platforms will be via the fixed stairs, which have 99 steps.\n\nThe Northern line escalators are not affected and at all other times a &#39;down&#39; escalator service to the Victoria line will be available.\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Canary Wharf Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CANARY WHARF: Reduced escalator service from Wednesday 7 January until early April. This is while we carry out planned maintenance work on two escalators, one at a time. During this work, please use alternative escalators]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Angel Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Angel Underground Station: Reduced escalator service Monday 5 January until mid-July 2015. This is while we carry out planned refurbishment work. Please use the remaining escalators. The station may be busier at times, please allow additional time for your journey.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Holloway Road Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Holloway Road Underground Station: Reduced lift service Monday 5 January until late March 2015.This is while we carry out maintenance on both lifts, one at a time. During these works, please use the remaining lift or take care on the 62 stairs.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Covent Garden Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Covent Garden: This station is open for exit only. There is no entry from street level due to planned lift maintenance. Westbound trains at weekends are not serving the station.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Covent Garden Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Covent Garden: This station is open for exit only. There is no entry from street level due to planned lift maintenance. Westbound trains at weekends are not serving the station.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Covent Garden Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Covent Garden: This station is open for exit only. There is no entry from street level due to planned lift maintenance. Westbound trains at weekends are not serving the station.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Canning Town Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Canning Town Underground Station: Reduced escalator service from Monday 26 January until late April. This is while we carry out planned maintenance work on two escalators, one at a time. Please take care on the fixed stairs. Alternatively, use escalators, stairs or lifts further along the platforms.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Vauxhall Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Vauxhall Station: No lift service between the bus station and the London Underground station until autumn 2015. \nIf you are unable to use the stairs, please take bus 360 from stop B at Vauxhall to Pimlico station, which has ramp into the ticket hall, 8 steps and then escalator access to the platforms\nFor Stockwell take bus 2 or 88 from stop D or bus 196 from stop G at Vauxhall. \nFor Brixton - take bus 2 from stop D or bus 196 from stop G at Vauxhall.\n]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>London Bridge Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[LONDON BRIDGE UNDERGROUND STATION: No step-free access to or from the Jubilee line at from Tuesday 24 February until mid-August. This is while we replace one lift. For step-free access to/from the Jubilee line please use buses to/from nearby Waterloo, Bermondsey or Southwark stations. To interchange between the Northern and Jubilee lines, change at King&#39;s Cross St. Pancras and Green Park. Alternatively, speak to a member of staff for assistance.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Epping Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[EPPING STATION: From Sunday 22 until Monday 30 March inclusive, there will be 160 fewer car parking spaces available in order to store equipment for planned engineering works.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Tottenham Court Road Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Part Closure]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[TOTTENHAM COURT ROAD STATION: Closed to Central line services from Monday 5 January until early December.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Victoria Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Victoria Underground Station: From Sunday 25 January, while we construct new lift shafts as part of our Tube improvements, queues are likely at busy times when changing between the Victoria line and District/Circle line platforms. If you are travelling at peak times, or with children or luggage, or have mobility impairment, you will find it easier to change between lines using one of the alternative routes listed on the Victoria information Page. If you travel via Green Park and Westminster, there are lifts available between platforms.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Green Park Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[GREEN PARK STATION: Reduced escalator service from Monday 23 March until late July. This is while we carry out planned refurbishment work. Please use alternative escalators. At busy times, a one-way system will be in place. To change from the Victoria line to the Jubilee line, please follow signs and staff direction via the ticket hall and \nPiccadilly line.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Waterloo Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[WATERLOO UNDERGROUND STATION: Planned maintenance work on moving walkway from Monday 9 March until late April. One of the two moving walkways will be out of service for planned maintenance work and will be unavailable for use. At busy times, a one-way system will be in place. Please follow signs and staff direction.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Canada Water Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[CANADA WATER STATION: No down escalator service from the ticket hall to southbound London Overground platform 3 until late June 2015. This is for planned refurbishment work. During this time, please follow signs and use the stairs or lift.]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Highbury &amp; Islington Rail Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Highbury &amp; Islington: Sunday 29 March, Brazil v Chile at Emirates Stadium (KO 1500): From 1630 until crowds have dispersed Highbury &amp; Islington station will operate as exit and interchange only. There will be no access to the station from street level. Please use Archway or Angel stations instead using the signed walking routes. There are also queuing systems in place at Arsenal and Finsbury Park stations. If you are walking between the Holloway Road and Angel station you are advised to use the signed route via Liverpool Road..]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station><Station><Name>Highbury &amp; Islington Underground Station</Name><Colour>000</Colour><BgColour>FFF</BgColour><Url>http://www.tfl.gov.uk/tfl/livetravelnews/realtime/tube/default.html</Url><Status><Text><![CDATA[Information]]></Text><Colour>000</Colour><BgColour>FFF</BgColour><Message><Text><![CDATA[Highbury &amp; Islington: Sunday 29 March, Brazil v Chile at Emirates Stadium (KO 1500): From 1630 until crowds have dispersed Highbury &amp; Islington station will operate as exit and interchange only. There will be no access to the station from street level. Please use Archway or Angel stations instead using the signed walking routes. There are also queuing systems in place at Arsenal and Finsbury Park stations. If you are walking between the Holloway Road and Angel station you are advised to use the signed route via Liverpool Road..]]></Text><Colour>000</Colour><BgColour>FFF</BgColour></Message></Status></Station></Stations></SyndicatedFeed>"
        xml = Nokogiri::XML(body)
      else
        response = RestClient.get WEEKEND_URL
        if DEBUG
          print "*****************\n"
          print response
          print "\n*****************\n"
        end
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    xml.css('Line').each do |l|
      # Clean line names
      name = l.css('Name').text.strip
      name.gsub!('H\'smith', 'Hammersmith')
      name.gsub!(' & ', ' and ')
      name.gsub!('Tram', 'Trams')

      line = Tube::Line.find_by name: name
      line.status = l.css('Status').css('Text').first.text.strip
      line.status_details = l.css('Status').css('Message').css('Text').text.strip
      text_colour = l.css('Status').css('Colour').text
      background_colour = l.css('Status').css('BgColour').text
      print "#{name},#{text_colour},#{background_colour}"
      lines << line
    end
    return lines
  end


end
