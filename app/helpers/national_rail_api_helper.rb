require 'rest_client'
module NationalRailApiHelper

  DEBUG = true
  URL = 'https://lite.realtime.nationalrail.co.uk/OpenLDBWS/ldb6.asmx'
  ACCESS_TOKEN = ENV['TRAINS_ACCESS_TOKEN']
  SOAP_HEADERS = '<?xml version="1.0"?><SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns1="http://thalesgroup.com/RTTI/2014-02-20/ldb/" xmlns:ns2="http://thalesgroup.com/RTTI/2010-11-01/ldb/commontypes"><SOAP-ENV:Header><ns2:AccessToken><ns2:TokenValue>' + ACCESS_TOKEN + '</ns2:TokenValue></ns2:AccessToken></SOAP-ENV:Header>'


  def self.get_departure_board crs    
    type = "DepartureBoard"
    return NationalRailApiHelper.get_board type, crs
  end


  def self.get_arrival_board crs    
    type = "ArrivalBoard"
    return NationalRailApiHelper.get_board type, crs
  end
  

  def self.get_service service_id
    soap_body = '<SOAP-ENV:Body><ns1:GetServiceDetailsRequest><ns1:serviceID>' + service_id + '</ns1:serviceID></ns1:GetServiceDetailsRequest></SOAP-ENV:Body></SOAP-ENV:Envelope>'
    begin
      if DEBUG
        service_id = "HreTSea4sUYimcIawP8ujg=="
        xml_good = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body><GetServiceDetailsResponse xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/"><GetServiceDetailsResult><generatedAt xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">2015-02-24T21:15:02.8287755+00:00</generatedAt><serviceType xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">train</serviceType><locationName xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">Cardiff Central</locationName><crs xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">CDF</crs><operator xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">Arriva Trains Wales</operator><operatorCode xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">AW</operatorCode><sta xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">20:59</sta><ata xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">21:01</ata><std xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">21:10</std><atd xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">On time</atd><previousCallingPoints xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><callingPointList serviceType="train" serviceChangeRequired="false" assocIsCancelled="false"><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Caerphilly</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CPH</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:40</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Lisvane &amp; Thornhill</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">LVT</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:44</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Llanishen</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">LLS</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:46</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:48</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Heath High Level</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HHL</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:49</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cardiff Queen Street</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CDQ</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:56</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">20:58</at></callingPoint></callingPointList></previousCallingPoints><subsequentCallingPoints xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><callingPointList serviceType="train" serviceChangeRequired="false" assocIsCancelled="false"><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Grangetown</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">GTN</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:14</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cogan</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CGN</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:18</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Eastbrook</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">EBK</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:20</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Dinas Powys</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">DNS</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:22</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cadoxton</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CAD</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:26</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Barry Docks</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BYD</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:29</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Barry</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BRY</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:33</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Barry Island</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BYI</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">21:40</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">On time</et></callingPoint></callingPointList></subsequentCallingPoints></GetServiceDetailsResult></GetServiceDetailsResponse></soap:Body></soap:Envelope>'
        xml_cancelled = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body><GetServiceDetailsResponse xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/"><GetServiceDetailsResult><generatedAt xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">2015-02-25T22:09:46.3731282+00:00</generatedAt><serviceType xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">train</serviceType><locationName xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">Port Glasgow</locationName><crs xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">PTG</crs><operator xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">ScotRail</operator><operatorCode xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">SR</operatorCode><isCancelled xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">true</isCancelled><disruptionReason xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">This train has been cancelled because of overhead wire problems</disruptionReason><std xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">22:39</std><etd xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">Cancelled</etd><previousCallingPoints xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><callingPointList serviceType="train" serviceChangeRequired="false" assocIsCancelled="false"><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Gourock</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">GRK</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:24</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Fort Matilda</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">FTM</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:27</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Greenock West</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">GKW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:30</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Greenock Central</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">GKC</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:32</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cartsdyke</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CDY</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:35</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Bogston</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BGS</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:37</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint></callingPointList></previousCallingPoints><subsequentCallingPoints xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><callingPointList serviceType="train" serviceChangeRequired="false" assocIsCancelled="false"><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Woodhall</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WDL</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:42</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Langbank</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">LGB</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:46</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Bishopton</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BPT</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:51</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Paisley St James</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">PYJ</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:56</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Paisley Gilmour Street</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">PYG</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">22:59</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Hillington West</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HLW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">23:03</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Hillington East</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HLE</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">23:05</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cardonald</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CDO</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">23:07</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Glasgow Central</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">GLC</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">23:14</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint></callingPointList></subsequentCallingPoints></GetServiceDetailsResult></GetServiceDetailsResponse></soap:Body></soap:Envelope>'
        xml_delay = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body><GetServiceDetailsResponse xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/"><GetServiceDetailsResult><generatedAt xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">2015-03-04T08:25:18.755231+00:00</generatedAt><serviceType xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">train</serviceType><locationName xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">Stourbridge Junction</locationName><crs xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">SBJ</crs><operator xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">London Midland</operator><operatorCode xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">LM</operatorCode><disruptionReason xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">This train has been delayed by a train fault</disruptionReason><sta xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">08:21</sta><eta xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">08:42</eta><std xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">08:22</std><etd xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">08:43</etd><previousCallingPoints xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><callingPointList serviceType="train" serviceChangeRequired="false" assocIsCancelled="false"><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Stratford-upon-Avon</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">SAV</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">06:52</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Stratford Parkway</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">STY</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">06:56</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Wilmcote</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WMC</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">06:59</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Wootton Wawen</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WWW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:03</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Henley-in-Arden</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HNL</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:07</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Danzey</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">DZY</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:11</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Wood End</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WDE</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:15</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">The Lakes</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">TLK</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:17</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Earlswood (West Midlands)</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">EWD</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:20</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Wythall</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WYT</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:23</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Whitlocks End</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WTE</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:26</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Shirley</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">SRL</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:29</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Yardley Wood</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">YRD</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:32</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Hall Green</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HLG</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:35</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Spring Road</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">SRI</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:37</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Tyseley</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">TYS</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:41</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Small Heath</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">SMA</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:43</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Birmingham Moor Street</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BMO</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:48</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:13</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Birmingham Snow Hill</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BSW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:53</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:16</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Jewellery Quarter</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">JEQ</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:55</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:19</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">The Hawthorns</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">THW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">07:59</st><at xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:23</at></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Smethwick Galton Bridge</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">SGB</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:02</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:25</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Langley Green</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">LGG</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:05</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:28</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Rowley Regis</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">ROW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:08</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:30</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Old Hill</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">OHL</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:12</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:34</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cradley Heath</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">CRA</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:15</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:36</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Lye</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">LYE</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:18</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:39</et></callingPoint></callingPointList></previousCallingPoints><subsequentCallingPoints xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><callingPointList serviceType="train" serviceChangeRequired="false" assocIsCancelled="false"><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Hagley</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HAG</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:25</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:46</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Blakedown</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">BKD</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:29</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:49</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Kidderminster</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">KID</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:33</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:58</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Hartlebury</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">HBY</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:39</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Droitwich Spa</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">DTW</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:47</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint><callingPoint><locationName xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Worcester Foregate Street</locationName><crs xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">WOF</crs><st xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">08:58</st><et xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">Cancelled</et></callingPoint></callingPointList></subsequentCallingPoints></GetServiceDetailsResult></GetServiceDetailsResponse></soap:Body></soap:Envelope>'
        xml = Nokogiri::XML(xml_delay)
      else
        response = RestClient.post URL, SOAP_HEADERS + soap_body, content_type: 'text/xml'
        puts response.body
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    service = Service.new service_id
    service.parse(xml)
    return service
  end


  def self.get_board type, crs
    soap_body = '<SOAP-ENV:Body><ns1:Get' + type + 'Request><ns1:crs>' + crs + '</ns1:crs></ns1:Get' + type + 'Request></SOAP-ENV:Body></SOAP-ENV:Envelope>'
    begin
      if DEBUG
        xml = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><soap:Body><GetDepartureBoardResponse xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/"><GetStationBoardResult><generatedAt xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">2015-03-04T08:16:04.3529024+00:00</generatedAt><locationName xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">Stourbridge Junction</locationName><crs xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">SBJ</crs><nrccMessages xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><message xmlns="http://thalesgroup.com/RTTI/2012-01-13/ldb/types">&lt;P&gt;Buses are replacing trains between Leamington Spa and Banbury until further notice. More details can be found in &lt;A href="http://nationalrail.co.uk/service_disruptions/90845.aspx"&gt;Latest Travel News.&lt;/A&gt;&lt;/P&gt;</message></nrccMessages><platformAvailable xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types">true</platformAvailable><trainServices xmlns="http://thalesgroup.com/RTTI/2014-02-20/ldb/types"><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></destination><std>08:14</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>a1fjqeZfLbAeiYj7e91Fag==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>08:15</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>/lSq18XRUnEwg5U4FtYUIQ==</serviceID></service><service><origin><location><locationName>Birmingham Moor Street</locationName><crs>BMO</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></destination><std>08:22</std><etd>08:41</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>4vxZe/XyDxuhyzMeHK5SCQ==</serviceID></service><service><origin><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Leamington Spa</locationName><crs>LMS</crs><via /><futureChangeTo /></location></destination><std>08:23</std><etd>On time</etd><operator>Chiltern Railways</operator><operatorCode>CH</operatorCode><serviceID>rXE5ZkOZQyLT5ZFUvfUWSg==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>08:25</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>VjpGevbWqNvm1+5sWQwaSA==</serviceID></service><service><origin><location><locationName>Leamington Spa</locationName><crs>LMS</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></destination><currentDestinations><location><locationName>Birmingham Snow Hill</locationName><crs>BSW</crs><via /><futureChangeTo /></location></currentDestinations><std>08:31</std><etd>Cancelled</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>RybQy6BaPoCGa2twDtnxxA==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>08:35</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>H2QVv7MjXhnx1u/YbSyplg==</serviceID></service><service><origin><location><locationName>Worcester Foregate Street</locationName><crs>WOF</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></destination><std>08:35</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>01iS70gtcgsZCkZnR5/2CA==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Dorridge</locationName><crs>DDG</crs><via /><futureChangeTo /></location></destination><std>08:45</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>gyWKLGv7Zy07/9XHqxUoaA==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>08:45</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>nakNYfdCo/vSIErKKW5jcQ==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stratford-upon-Avon</locationName><crs>SAV</crs><via /><futureChangeTo /></location></destination><std>08:53</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>iRCvMxc7cYyBaPa8t9mD0g==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>08:55</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>lTZtNhICrerFvc0m11gmkw==</serviceID></service><service><origin><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></destination><std>09:02</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>hlA9VhDWxvX+U310f7UEJQ==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>09:05</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>FdvNMedlHALNa/qDJjdJVw==</serviceID></service><service><origin><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Dorridge</locationName><crs>DDG</crs><via /><futureChangeTo /></location></destination><currentOrigins><location><locationName>Birmingham Snow Hill</locationName><crs>BSW</crs><via /><futureChangeTo /></location></currentOrigins><std>09:09</std><etd>Cancelled</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>7TTPN17pMpfRboxX8ovjcw==</serviceID></service><service><origin><location><locationName>Birmingham Snow Hill</locationName><crs>BSW</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Worcester Shrub Hill</locationName><crs>WOS</crs><via /><futureChangeTo /></location></destination><std>09:09</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>IZa5k7Ju/B8ES4gZO3vlWQ==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>09:15</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>vJjmgupC2Bi3uTFE8ALggQ==</serviceID></service><service><origin><location><locationName>Worcester Foregate Street</locationName><crs>WOF</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></destination><std>09:18</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>wII1Fhvp0bjhQpD6/4kqig==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>09:25</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>rqwxfdKKVMMwuXssVKYTfg==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stratford-upon-Avon</locationName><crs>SAV</crs><via /><futureChangeTo /></location></destination><std>09:27</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>YYnJrRE7pOUxiJ2O0s/cSQ==</serviceID></service><service><origin><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></destination><std>09:28</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>ctQAUIcndu0wYjOqjtGmPw==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>09:35</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>/pokwq+WWK3yGMlrOE3kBQ==</serviceID></service><service><origin><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></destination><std>09:37</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>245Rte5DSlXW/6yn2LgjdQ==</serviceID></service><service><origin><location><locationName>Dorridge</locationName><crs>DDG</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Worcester Foregate Street</locationName><crs>WOF</crs><via /><futureChangeTo /></location></destination><std>09:39</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>J63fTbRyaQlhrvSEQiujLg==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>09:45</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>amjyAl8QYoHSqxyIZDtFPA==</serviceID></service><service><origin><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Dorridge</locationName><crs>DDG</crs><via /><futureChangeTo /></location></destination><std>09:48</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>WeiJGzAMf2vvnKIwGKGqjw==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>09:55</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>/khxMc1w4ewhv2IOGHaQZA==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stratford-upon-Avon</locationName><crs>SAV</crs><via /><futureChangeTo /></location></destination><std>09:57</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>4KJ/j03vhAKMedUTtXOrBQ==</serviceID></service><service><origin><location><locationName>Birmingham Snow Hill</locationName><crs>BSW</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></destination><std>09:59</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>twGSPOkP+dCcLNZY9RoNcQ==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>10:05</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>/fNBcnRgf12EjxShXr3G3w==</serviceID></service><service><origin><location><locationName>Kidderminster</locationName><crs>KID</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Dorridge</locationName><crs>DDG</crs><via /><futureChangeTo /></location></destination><std>10:07</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>rzfo+PKoCHb1b4IsqEfWEg==</serviceID></service><service><origin><location><locationName>Whitlocks End</locationName><crs>WTE</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Great Malvern</locationName><crs>GMV</crs><via /><futureChangeTo /></location></destination><std>10:09</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>iykEFx0gdp+3AEj99cdN4g==</serviceID></service><service><origin><location><locationName>Stourbridge Junction</locationName><crs>SBJ</crs><via /><futureChangeTo /></location></origin><destination><location><locationName>Stourbridge Town</locationName><crs>SBT</crs><via /><futureChangeTo /></location></destination><std>10:15</std><etd>On time</etd><operator>London Midland</operator><operatorCode>LM</operatorCode><serviceID>8khVosfSGlvEtbSJSOvJrg==</serviceID></service></trainServices></GetStationBoardResult></GetDepartureBoardResponse></soap:Body></soap:Envelope>'
        xml = Nokogiri::XML(xml)
      else
        response = RestClient.post URL, SOAP_HEADERS + soap_body, content_type: 'text/xml'
        puts response.body
        xml = Nokogiri::XML(response.body)
      end
    rescue => e
      puts e.inspect
      return
    end
    xml.remove_namespaces!
    station_board = StationBoard.new
    station_board.parse(xml)
    return station_board
  end


end
